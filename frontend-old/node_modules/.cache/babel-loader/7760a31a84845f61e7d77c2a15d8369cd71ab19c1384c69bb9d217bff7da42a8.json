{"ast":null,"code":"// services/api.js\nimport axios from 'axios';\nimport { logApiError } from '../utils/logger';\n\n// ===== Base URL via .env (CRA) =====\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n\n// ===== Instance axios par défaut =====\n// On garde une instance \"publiques\" pour compat (GET publiques existantes)\nconst http = axios.create({\n  baseURL: API_BASE,\n  withCredentials: true // <-- enable cookies (SameSite handled by backend cookie)\n});\n\n// ===== Instance axios avec auth =====\n// Cette instance attache automatiquement le token s'il est présent\nconst authHttp = axios.create({\n  baseURL: API_BASE,\n  withCredentials: true // <-- send cookies automatically\n});\n\n// --- Token management (in-memory) ---\nlet _token = null;\nexport function setToken(token) {\n  _token = token;\n  if (token) {\n    // keep Authorization header for in-memory access-token usage (optional)\n    authHttp.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    try {\n      window.dispatchEvent(new Event('auth:login'));\n    } catch {}\n  } else {\n    delete authHttp.defaults.headers.common['Authorization'];\n    try {\n      window.dispatchEvent(new CustomEvent('auth:logout', {\n        detail: {\n          reason: 'manual'\n        }\n      }));\n    } catch {}\n  }\n}\nexport function getToken() {\n  return _token;\n}\nexport function clearToken() {\n  setToken(null);\n}\n\n// ==========================\n//   CROSS-CUTTING HELPERS\n// ==========================\nexport function getRetryAfterSeconds(err) {\n  var _err$response, _err$response$headers;\n  const raw = err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$headers = _err$response.headers) === null || _err$response$headers === void 0 ? void 0 : _err$response$headers['retry-after'];\n  if (!raw) return null;\n  const n = Number(raw);\n  return Number.isFinite(n) && n > 0 ? n : null;\n}\nfunction dispatchLogout(reason = 'unauthorized') {\n  clearToken();\n\n  // Let the app react if it wants (optional)\n  try {\n    window.dispatchEvent(new CustomEvent('auth:logout', {\n      detail: {\n        reason\n      }\n    }));\n  } catch {\n    // ignore\n  }\n\n  // Note: do NOT redirect to /login automatically. The app should remain browsable\n  // for anonymous users; authenticated-only actions will fail with 401 and the\n  // UI can decide whether to prompt for login or show an error. This keeps\n  // read-only browsing available by default.\n}\n\n// ==========================\n//    NORMALISATION PAYLOADS\n// ==========================\nfunction normalizeArticlePayload(payload = {}) {\n  var _payload$titre, _ref, _payload$imageUrl, _payload$sourceUrl;\n  // Canonique frontend: { titre, description, imageUrl, sourceUrl }\n  // Back-compat: { title, src, image_url, source_url }\n  return {\n    ...(payload.titre != null || payload.title != null ? {\n      titre: (_payload$titre = payload.titre) !== null && _payload$titre !== void 0 ? _payload$titre : payload.title\n    } : {}),\n    ...(payload.description != null ? {\n      description: payload.description\n    } : {}),\n    ...(payload.imageUrl != null || payload.image_url != null || payload.src != null ? {\n      imageUrl: (_ref = (_payload$imageUrl = payload.imageUrl) !== null && _payload$imageUrl !== void 0 ? _payload$imageUrl : payload.image_url) !== null && _ref !== void 0 ? _ref : payload.src\n    } : {}),\n    ...(payload.sourceUrl != null || payload.source_url != null ? {\n      sourceUrl: (_payload$sourceUrl = payload.sourceUrl) !== null && _payload$sourceUrl !== void 0 ? _payload$sourceUrl : payload.source_url\n    } : {})\n  };\n}\nfunction normalizeDictionnairePayload(payload = {}) {\n  var _payload$motsFrancais, _payload$motsProvenca, _payload$synonymesFra, _payload$egProvencal, _payload$dProvencal, _payload$aProvencal;\n  // Canonique frontend: camelCase (motsFrancais, motsProvencal, ...)\n  // Back-compat: snake_case\n  return {\n    ...(payload.theme != null ? {\n      theme: payload.theme\n    } : {}),\n    ...(payload.categorie != null ? {\n      categorie: payload.categorie\n    } : {}),\n    ...(payload.description != null ? {\n      description: payload.description\n    } : {}),\n    ...(payload.motsFrancais != null || payload.mots_francais != null ? {\n      motsFrancais: (_payload$motsFrancais = payload.motsFrancais) !== null && _payload$motsFrancais !== void 0 ? _payload$motsFrancais : payload.mots_francais\n    } : {}),\n    ...(payload.motsProvencal != null || payload.mots_provencal != null ? {\n      motsProvencal: (_payload$motsProvenca = payload.motsProvencal) !== null && _payload$motsProvenca !== void 0 ? _payload$motsProvenca : payload.mots_provencal\n    } : {}),\n    ...(payload.synonymesFrancais != null || payload.synonymes_francais != null ? {\n      synonymesFrancais: (_payload$synonymesFra = payload.synonymesFrancais) !== null && _payload$synonymesFra !== void 0 ? _payload$synonymesFra : payload.synonymes_francais\n    } : {}),\n    ...(payload.egProvencal != null || payload.eg_provencal != null ? {\n      egProvencal: (_payload$egProvencal = payload.egProvencal) !== null && _payload$egProvencal !== void 0 ? _payload$egProvencal : payload.eg_provencal\n    } : {}),\n    ...(payload.dProvencal != null || payload.d_provencal != null ? {\n      dProvencal: (_payload$dProvencal = payload.dProvencal) !== null && _payload$dProvencal !== void 0 ? _payload$dProvencal : payload.d_provencal\n    } : {}),\n    ...(payload.aProvencal != null || payload.a_provencal != null ? {\n      aProvencal: (_payload$aProvencal = payload.aProvencal) !== null && _payload$aProvencal !== void 0 ? _payload$aProvencal : payload.a_provencal\n    } : {})\n  };\n}\n\n// --- Response normalizers (defensive back-compat) ---\nfunction normalizeArticleOut(a = {}) {\n  var _ref2, _ref3, _a$imageUrl, _ref4, _a$sourceUrl, _ref5, _a$imageStored;\n  return {\n    ...a,\n    imageUrl: (_ref2 = (_ref3 = (_a$imageUrl = a.imageUrl) !== null && _a$imageUrl !== void 0 ? _a$imageUrl : a.image_url) !== null && _ref3 !== void 0 ? _ref3 : a.src) !== null && _ref2 !== void 0 ? _ref2 : '',\n    sourceUrl: (_ref4 = (_a$sourceUrl = a.sourceUrl) !== null && _a$sourceUrl !== void 0 ? _a$sourceUrl : a.source_url) !== null && _ref4 !== void 0 ? _ref4 : '',\n    imageStored: (_ref5 = (_a$imageStored = a.imageStored) !== null && _a$imageStored !== void 0 ? _a$imageStored : a.image_stored) !== null && _ref5 !== void 0 ? _ref5 : false\n  };\n}\nfunction normalizeMotOut(m = {}) {\n  var _ref6, _m$motsFrancais, _ref7, _m$motsProvencal, _ref8, _m$synonymesFrancais, _ref9, _m$egProvencal, _ref0, _m$dProvencal, _ref1, _m$aProvencal;\n  return {\n    ...m,\n    motsFrancais: (_ref6 = (_m$motsFrancais = m.motsFrancais) !== null && _m$motsFrancais !== void 0 ? _m$motsFrancais : m.mots_francais) !== null && _ref6 !== void 0 ? _ref6 : '',\n    motsProvencal: (_ref7 = (_m$motsProvencal = m.motsProvencal) !== null && _m$motsProvencal !== void 0 ? _m$motsProvencal : m.mots_provencal) !== null && _ref7 !== void 0 ? _ref7 : '',\n    synonymesFrancais: (_ref8 = (_m$synonymesFrancais = m.synonymesFrancais) !== null && _m$synonymesFrancais !== void 0 ? _m$synonymesFrancais : m.synonymes_francais) !== null && _ref8 !== void 0 ? _ref8 : '',\n    egProvencal: (_ref9 = (_m$egProvencal = m.egProvencal) !== null && _m$egProvencal !== void 0 ? _m$egProvencal : m.eg_provencal) !== null && _ref9 !== void 0 ? _ref9 : '',\n    dProvencal: (_ref0 = (_m$dProvencal = m.dProvencal) !== null && _m$dProvencal !== void 0 ? _m$dProvencal : m.d_provencal) !== null && _ref0 !== void 0 ? _ref0 : '',\n    aProvencal: (_ref1 = (_m$aProvencal = m.aProvencal) !== null && _m$aProvencal !== void 0 ? _m$aProvencal : m.a_provencal) !== null && _ref1 !== void 0 ? _ref1 : ''\n    // keep theme/categorie/description as-is (already same name in API)\n  };\n}\n\n// --- Histoires: response normalizers (menu + détail) ---\nfunction normalizeHistoireOut(h = {}) {\n  var _ref10, _h$descriptionCourte, _ref11, _h$descriptionLongue, _ref12, _h$sourceUrl;\n  return {\n    ...h,\n    descriptionCourte: (_ref10 = (_h$descriptionCourte = h.descriptionCourte) !== null && _h$descriptionCourte !== void 0 ? _h$descriptionCourte : h.description_courte) !== null && _ref10 !== void 0 ? _ref10 : '',\n    descriptionLongue: (_ref11 = (_h$descriptionLongue = h.descriptionLongue) !== null && _h$descriptionLongue !== void 0 ? _h$descriptionLongue : h.description_longue) !== null && _ref11 !== void 0 ? _ref11 : '',\n    sourceUrl: (_ref12 = (_h$sourceUrl = h.sourceUrl) !== null && _h$sourceUrl !== void 0 ? _h$sourceUrl : h.source_url) !== null && _ref12 !== void 0 ? _ref12 : ''\n    // titre/typologie/periode are already camelCase in API (but keep as-is)\n  };\n}\nfunction normalizeMenuItemOut(item = {}) {\n  var _ref13, _item$descriptionCour;\n  return {\n    ...item,\n    descriptionCourte: (_ref13 = (_item$descriptionCour = item.descriptionCourte) !== null && _item$descriptionCour !== void 0 ? _item$descriptionCour : item.description_courte) !== null && _ref13 !== void 0 ? _ref13 : ''\n  };\n}\n\n// --- Cartes (Géographie): response normalizers ---\nfunction normalizeCarteOut(c = {}) {\n  var _ref14, _c$iframeUrl, _ref15, _c$legende, _ref16, _c$imageStored;\n  return {\n    ...c,\n    iframeUrl: (_ref14 = (_c$iframeUrl = c.iframeUrl) !== null && _c$iframeUrl !== void 0 ? _c$iframeUrl : c.iframe_url) !== null && _ref14 !== void 0 ? _ref14 : '',\n    // legende/titre are camelCase already via API aliases, but keep back-compat\n    legende: (_ref15 = (_c$legende = c.legende) !== null && _c$legende !== void 0 ? _c$legende : c.legende) !== null && _ref15 !== void 0 ? _ref15 : '',\n    imageStored: (_ref16 = (_c$imageStored = c.imageStored) !== null && _c$imageStored !== void 0 ? _c$imageStored : c.image_stored) !== null && _ref16 !== void 0 ? _ref16 : false\n  };\n}\nfunction normalizeCartePayload(payload = {}) {\n  var _payload$iframeUrl;\n  const rawIframe = (_payload$iframeUrl = payload.iframeUrl) !== null && _payload$iframeUrl !== void 0 ? _payload$iframeUrl : payload.iframe_url;\n  const hasIframe = typeof rawIframe === 'string' ? rawIframe.trim() !== '' : rawIframe != null;\n  return {\n    ...(payload.titre != null ? {\n      titre: payload.titre\n    } : {}),\n    ...(payload.iframeUrl != null || payload.iframe_url != null ? {\n      iframeUrl: hasIframe ? typeof rawIframe === 'string' ? rawIframe.trim() : rawIframe : null\n    } : {}),\n    ...(payload.legende != null ? {\n      legende: payload.legende\n    } : {})\n  };\n}\n\n/**\r\n * Shape attendu:\r\n * {\r\n *   [typologie]: {\r\n *     [periode]: [{ id, titre, descriptionCourte }]\r\n *   }\r\n * }\r\n */\nfunction normalizeMenuHistoiresOut(menu = {}) {\n  if (!menu || typeof menu !== 'object') return {};\n  const out = {};\n  for (const [typologie, periodes] of Object.entries(menu)) {\n    const periodesObj = periodes && typeof periodes === 'object' ? periodes : {};\n    out[typologie] = {};\n    for (const [periode, items] of Object.entries(periodesObj)) {\n      out[typologie][periode] = Array.isArray(items) ? items.map(normalizeMenuItemOut) : [];\n    }\n  }\n  return out;\n}\n\n// ==========================\n//        AXIOS INSTANCES\n// ==========================\n\n// Interceptor pour l'instance auth\nauthHttp.interceptors.request.use(config => {\n  const token = getToken();\n  if (token) {\n    config.headers = {\n      ...config.headers,\n      Authorization: `Bearer ${token}`\n    };\n  }\n  return config;\n});\n\n// Global response handling (auth)\nauthHttp.interceptors.response.use(res => res, err => {\n  var _err$response2;\n  const status = err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status;\n  if (status === 401) dispatchLogout('token_invalid_or_expired');\n  logApiError(err);\n  return Promise.reject(err);\n});\n\n// Also log public API errors (no logout here)\nhttp.interceptors.response.use(res => res, err => {\n  logApiError(err);\n  return Promise.reject(err);\n});\n\n// ==========================\n//        ENDPOINTS\n// ==========================\n\n// --- Articles (publics) ---\nexport const getArticles = () => http.get(`/articles`).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeArticleOut) : res.data\n}));\n\n// Create a new article (authenticated)\nexport async function createArticle(payload) {\n  const {\n    data\n  } = await authHttp.post(`/articles`, normalizeArticlePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeArticleOut(data);\n}\n\n// Delete an article (authenticated)\nexport async function deleteArticle(id) {\n  const res = await authHttp.delete(`/articles/${id}`);\n  return res;\n}\n\n// --- Dictionnaire (publics) ---\nexport const getDictionary = params => http.get(`/dictionnaire`, {\n  params\n}).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeMotOut) : res.data\n}));\nexport const getThemes = () => http.get(`/dictionnaire/themes`);\nexport const getCategories = theme => http.get(`/dictionnaire/categories`, {\n  params: {\n    theme\n  }\n});\n\n// --- Histoires & Légendes (publics) ---\nexport const getHistoires = params => http.get(`/histoires`, {\n  params\n});\n\n// Keep response shape, but normalize res.data for UI camelCase-only consumption\nexport const getMenuHistoires = () => http.get(`/histoires/menu`).then(res => ({\n  ...res,\n  data: normalizeMenuHistoiresOut(res.data)\n}));\nexport const getHistoireById = id => http.get(`/histoires/${id}`).then(res => ({\n  ...res,\n  data: normalizeHistoireOut(res.data)\n}));\nexport const findHistoire = titre => http.get(`/histoires/find`, {\n  params: {\n    titre\n  }\n}).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeHistoireOut) : res.data\n}));\nexport const getHistoiresPaged = ({\n  page,\n  limit\n}) => http.get(`/histoires/paged`, {\n  params: {\n    page,\n    limit\n  }\n});\n\n// --- Histoires (CRUD) (authenticated) ---\nexport async function createHistoire(payload) {\n  const {\n    data\n  } = await authHttp.post(`/histoires`, payload, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeHistoireOut(data);\n}\nexport async function updateHistoire(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/histoires/${id}`, payload, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeHistoireOut(data);\n}\nexport async function deleteHistoire(id) {\n  const res = await authHttp.delete(`/histoires/${id}`);\n  return res;\n}\n\n// --- Cartes (Géographie) (public + authenticated mutations) ---\nexport const getCartes = params => http.get(`/cartes`, {\n  params\n}).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeCarteOut) : res.data\n}));\nexport async function createCarte(payload) {\n  const {\n    data\n  } = await authHttp.post(`/cartes`, normalizeCartePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeCarteOut(data);\n}\nexport async function updateCarte(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/cartes/${id}`, normalizeCartePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeCarteOut(data);\n}\nexport async function deleteCarte(id) {\n  const res = await authHttp.delete(`/cartes/${id}`);\n  return res;\n}\n\n// ==========================\n//   STORED IMAGES (BINARY)\n// ==========================\n\nexport function getArticleImageUrl(id, cacheBuster) {\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\n  return `${API_BASE}/articles/${id}/image${qs}`;\n}\nexport function getCarteImageUrl(id, cacheBuster) {\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\n  return `${API_BASE}/cartes/${id}/image${qs}`;\n}\nexport async function uploadArticleImage(id, file) {\n  const fd = new FormData();\n  fd.append('image', file);\n  const {\n    data\n  } = await authHttp.put(`/articles/${id}/image`, fd);\n  return normalizeArticleOut(data);\n}\nexport async function deleteArticleImage(id) {\n  const {\n    data\n  } = await authHttp.delete(`/articles/${id}/image`);\n  return normalizeArticleOut(data);\n}\nexport async function uploadCarteImage(id, file) {\n  const fd = new FormData();\n  fd.append('image', file);\n  const {\n    data\n  } = await authHttp.put(`/cartes/${id}/image`, fd);\n  return normalizeCarteOut(data);\n}\nexport async function deleteCarteImage(id) {\n  const {\n    data\n  } = await authHttp.delete(`/cartes/${id}/image`);\n  return normalizeCarteOut(data);\n}\n\n// --- Dictionnaire: update d'un mot (ligne du tableau)\nexport async function updateMot(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/dictionnaire/${id}`, normalizeDictionnairePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeMotOut(data);\n}\n\n// --- Articles: update d'une carte/article\nexport async function updateArticle(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/articles/${id}`, normalizeArticlePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeArticleOut(data);\n}\n\n// ==========================\n//       AUTH SERVICES\n// ==========================\n\nexport async function login({\n  username,\n  password\n}) {\n  const params = new URLSearchParams();\n  params.append('username', username);\n  params.append('password', password);\n  const {\n    data\n  } = await http.post(`/auth/login`, params, {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    }\n  });\n  if (data !== null && data !== void 0 && data.access_token) setToken(data.access_token);\n  return data;\n}\nexport async function register({\n  username,\n  password\n}) {\n  const {\n    data\n  } = await http.post(`/auth/register`, {\n    username,\n    password\n  }, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return data;\n}\n\n/**\r\n * Récupère l'utilisateur courant (protégé)\r\n * - Nécessite Authorization: Bearer <token>\r\n * - Retour: { username }\r\n */\nexport async function getMe() {\n  const {\n    data\n  } = await authHttp.get(`/auth/me`);\n  return data;\n}\n\n// (Optionnel) helper logout\nexport function logout() {\n  dispatchLogout('manual');\n}\n\n// ==========================\n//    EXPORTS UTILES PAR DÉFAUT\n// ==========================\nexport const api = http;\nexport const apiAuth = authHttp;\n\n// --- Error handling ---\nexport function getApiErrorMessage(err) {\n  var _err$response3, _err$response4, _err$response4$header, _err$response5, _err$response5$data, _err$response6, _err$response6$data;\n  const status = err === null || err === void 0 ? void 0 : (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : _err$response3.status;\n  const retryAfter = err === null || err === void 0 ? void 0 : (_err$response4 = err.response) === null || _err$response4 === void 0 ? void 0 : (_err$response4$header = _err$response4.headers) === null || _err$response4$header === void 0 ? void 0 : _err$response4$header['retry-after'];\n  const detail = err === null || err === void 0 ? void 0 : (_err$response5 = err.response) === null || _err$response5 === void 0 ? void 0 : (_err$response5$data = _err$response5.data) === null || _err$response5$data === void 0 ? void 0 : _err$response5$data.detail;\n  if (detail && typeof detail === 'object') {\n    if (typeof detail.message === 'string' && detail.message.trim() !== '') return detail.message;\n    if (typeof detail.code === 'string' && detail.code.trim() !== '') return detail.code;\n    try {\n      return JSON.stringify(detail);\n    } catch {\n      return 'Erreur API';\n    }\n  }\n  if (typeof detail === 'string') return detail;\n  const msg = (err === null || err === void 0 ? void 0 : (_err$response6 = err.response) === null || _err$response6 === void 0 ? void 0 : (_err$response6$data = _err$response6.data) === null || _err$response6$data === void 0 ? void 0 : _err$response6$data.message) || (err === null || err === void 0 ? void 0 : err.message);\n  const base = typeof msg === 'string' ? msg : 'Erreur API';\n  if (status === 429 && retryAfter) return `${base} (Retry-After: ${retryAfter}s)`;\n  return base;\n}","map":{"version":3,"names":["axios","logApiError","API_BASE","process","env","REACT_APP_API_URL","http","create","baseURL","withCredentials","authHttp","_token","setToken","token","defaults","headers","common","window","dispatchEvent","Event","CustomEvent","detail","reason","getToken","clearToken","getRetryAfterSeconds","err","_err$response","_err$response$headers","raw","response","n","Number","isFinite","dispatchLogout","normalizeArticlePayload","payload","_payload$titre","_ref","_payload$imageUrl","_payload$sourceUrl","titre","title","description","imageUrl","image_url","src","sourceUrl","source_url","normalizeDictionnairePayload","_payload$motsFrancais","_payload$motsProvenca","_payload$synonymesFra","_payload$egProvencal","_payload$dProvencal","_payload$aProvencal","theme","categorie","motsFrancais","mots_francais","motsProvencal","mots_provencal","synonymesFrancais","synonymes_francais","egProvencal","eg_provencal","dProvencal","d_provencal","aProvencal","a_provencal","normalizeArticleOut","a","_ref2","_ref3","_a$imageUrl","_ref4","_a$sourceUrl","_ref5","_a$imageStored","imageStored","image_stored","normalizeMotOut","m","_ref6","_m$motsFrancais","_ref7","_m$motsProvencal","_ref8","_m$synonymesFrancais","_ref9","_m$egProvencal","_ref0","_m$dProvencal","_ref1","_m$aProvencal","normalizeHistoireOut","h","_ref10","_h$descriptionCourte","_ref11","_h$descriptionLongue","_ref12","_h$sourceUrl","descriptionCourte","description_courte","descriptionLongue","description_longue","normalizeMenuItemOut","item","_ref13","_item$descriptionCour","normalizeCarteOut","c","_ref14","_c$iframeUrl","_ref15","_c$legende","_ref16","_c$imageStored","iframeUrl","iframe_url","legende","normalizeCartePayload","_payload$iframeUrl","rawIframe","hasIframe","trim","normalizeMenuHistoiresOut","menu","out","typologie","periodes","Object","entries","periodesObj","periode","items","Array","isArray","map","interceptors","request","use","config","Authorization","res","_err$response2","status","Promise","reject","getArticles","get","then","data","createArticle","post","deleteArticle","id","delete","getDictionary","params","getThemes","getCategories","getHistoires","getMenuHistoires","getHistoireById","findHistoire","getHistoiresPaged","page","limit","createHistoire","updateHistoire","put","deleteHistoire","getCartes","createCarte","updateCarte","deleteCarte","getArticleImageUrl","cacheBuster","qs","encodeURIComponent","String","getCarteImageUrl","uploadArticleImage","file","fd","FormData","append","deleteArticleImage","uploadCarteImage","deleteCarteImage","updateMot","updateArticle","login","username","password","URLSearchParams","access_token","register","getMe","logout","api","apiAuth","getApiErrorMessage","_err$response3","_err$response4","_err$response4$header","_err$response5","_err$response5$data","_err$response6","_err$response6$data","retryAfter","message","code","JSON","stringify","msg","base"],"sources":["/mnt/c/code/leprovencal.ia/frontend/src/services/api.js"],"sourcesContent":["// services/api.js\r\nimport axios from 'axios';\r\nimport { logApiError } from '../utils/logger';\r\n\r\n// ===== Base URL via .env (CRA) =====\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:8000';\r\n\r\n// ===== Instance axios par défaut =====\r\n// On garde une instance \"publiques\" pour compat (GET publiques existantes)\r\nconst http = axios.create({\r\n  baseURL: API_BASE,\r\n  withCredentials: true, // <-- enable cookies (SameSite handled by backend cookie)\r\n});\r\n\r\n// ===== Instance axios avec auth =====\r\n// Cette instance attache automatiquement le token s'il est présent\r\nconst authHttp = axios.create({\r\n  baseURL: API_BASE,\r\n  withCredentials: true, // <-- send cookies automatically\r\n});\r\n\r\n// --- Token management (in-memory) ---\r\nlet _token = null;\r\n\r\nexport function setToken(token) {\r\n  _token = token;\r\n  if (token) {\r\n    // keep Authorization header for in-memory access-token usage (optional)\r\n    authHttp.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n    try { window.dispatchEvent(new Event('auth:login')); } catch {}\r\n  } else {\r\n    delete authHttp.defaults.headers.common['Authorization'];\r\n    try { window.dispatchEvent(new CustomEvent('auth:logout', { detail: { reason: 'manual' } })); } catch {}\r\n  }\r\n}\r\n\r\nexport function getToken() {\r\n  return _token;\r\n}\r\n\r\nexport function clearToken() {\r\n  setToken(null);\r\n}\r\n\r\n// ==========================\r\n//   CROSS-CUTTING HELPERS\r\n// ==========================\r\nexport function getRetryAfterSeconds(err) {\r\n  const raw = err?.response?.headers?.['retry-after'];\r\n  if (!raw) return null;\r\n  const n = Number(raw);\r\n  return Number.isFinite(n) && n > 0 ? n : null;\r\n}\r\n\r\nfunction dispatchLogout(reason = 'unauthorized') {\r\n  clearToken();\r\n\r\n  // Let the app react if it wants (optional)\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('auth:logout', { detail: { reason } }));\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  // Note: do NOT redirect to /login automatically. The app should remain browsable\r\n  // for anonymous users; authenticated-only actions will fail with 401 and the\r\n  // UI can decide whether to prompt for login or show an error. This keeps\r\n  // read-only browsing available by default.\r\n}\r\n\r\n// ==========================\r\n//    NORMALISATION PAYLOADS\r\n// ==========================\r\nfunction normalizeArticlePayload(payload = {}) {\r\n  // Canonique frontend: { titre, description, imageUrl, sourceUrl }\r\n  // Back-compat: { title, src, image_url, source_url }\r\n  return {\r\n    ...(payload.titre != null || payload.title != null ? { titre: payload.titre ?? payload.title } : {}),\r\n    ...(payload.description != null ? { description: payload.description } : {}),\r\n    ...(payload.imageUrl != null || payload.image_url != null || payload.src != null\r\n      ? { imageUrl: payload.imageUrl ?? payload.image_url ?? payload.src }\r\n      : {}),\r\n    ...(payload.sourceUrl != null || payload.source_url != null ? { sourceUrl: payload.sourceUrl ?? payload.source_url } : {}),\r\n  };\r\n}\r\n\r\nfunction normalizeDictionnairePayload(payload = {}) {\r\n  // Canonique frontend: camelCase (motsFrancais, motsProvencal, ...)\r\n  // Back-compat: snake_case\r\n  return {\r\n    ...(payload.theme != null ? { theme: payload.theme } : {}),\r\n    ...(payload.categorie != null ? { categorie: payload.categorie } : {}),\r\n    ...(payload.description != null ? { description: payload.description } : {}),\r\n    ...(payload.motsFrancais != null || payload.mots_francais != null ? { motsFrancais: payload.motsFrancais ?? payload.mots_francais } : {}),\r\n    ...(payload.motsProvencal != null || payload.mots_provencal != null ? { motsProvencal: payload.motsProvencal ?? payload.mots_provencal } : {}),\r\n    ...(payload.synonymesFrancais != null || payload.synonymes_francais != null ? { synonymesFrancais: payload.synonymesFrancais ?? payload.synonymes_francais } : {}),\r\n    ...(payload.egProvencal != null || payload.eg_provencal != null ? { egProvencal: payload.egProvencal ?? payload.eg_provencal } : {}),\r\n    ...(payload.dProvencal != null || payload.d_provencal != null ? { dProvencal: payload.dProvencal ?? payload.d_provencal } : {}),\r\n    ...(payload.aProvencal != null || payload.a_provencal != null ? { aProvencal: payload.aProvencal ?? payload.a_provencal } : {}),\r\n  };\r\n}\r\n\r\n// --- Response normalizers (defensive back-compat) ---\r\nfunction normalizeArticleOut(a = {}) {\r\n  return {\r\n    ...a,\r\n    imageUrl: a.imageUrl ?? a.image_url ?? a.src ?? '',\r\n    sourceUrl: a.sourceUrl ?? a.source_url ?? '',\r\n    imageStored: a.imageStored ?? a.image_stored ?? false,\r\n  };\r\n}\r\n\r\nfunction normalizeMotOut(m = {}) {\r\n  return {\r\n    ...m,\r\n    motsFrancais: m.motsFrancais ?? m.mots_francais ?? '',\r\n    motsProvencal: m.motsProvencal ?? m.mots_provencal ?? '',\r\n    synonymesFrancais: m.synonymesFrancais ?? m.synonymes_francais ?? '',\r\n    egProvencal: m.egProvencal ?? m.eg_provencal ?? '',\r\n    dProvencal: m.dProvencal ?? m.d_provencal ?? '',\r\n    aProvencal: m.aProvencal ?? m.a_provencal ?? '',\r\n    // keep theme/categorie/description as-is (already same name in API)\r\n  };\r\n}\r\n\r\n// --- Histoires: response normalizers (menu + détail) ---\r\nfunction normalizeHistoireOut(h = {}) {\r\n  return {\r\n    ...h,\r\n    descriptionCourte: h.descriptionCourte ?? h.description_courte ?? '',\r\n    descriptionLongue: h.descriptionLongue ?? h.description_longue ?? '',\r\n    sourceUrl: h.sourceUrl ?? h.source_url ?? '',\r\n    // titre/typologie/periode are already camelCase in API (but keep as-is)\r\n  };\r\n}\r\n\r\nfunction normalizeMenuItemOut(item = {}) {\r\n  return {\r\n    ...item,\r\n    descriptionCourte: item.descriptionCourte ?? item.description_courte ?? '',\r\n  };\r\n}\r\n\r\n// --- Cartes (Géographie): response normalizers ---\r\nfunction normalizeCarteOut(c = {}) {\r\n  return {\r\n    ...c,\r\n    iframeUrl: c.iframeUrl ?? c.iframe_url ?? '',\r\n    // legende/titre are camelCase already via API aliases, but keep back-compat\r\n    legende: c.legende ?? c.legende ?? '',\r\n    imageStored: c.imageStored ?? c.image_stored ?? false,\r\n  };\r\n}\r\n\r\nfunction normalizeCartePayload(payload = {}) {\r\n  const rawIframe = payload.iframeUrl ?? payload.iframe_url;\r\n  const hasIframe = typeof rawIframe === 'string' ? rawIframe.trim() !== '' : rawIframe != null;\r\n  return {\r\n    ...(payload.titre != null ? { titre: payload.titre } : {}),\r\n    ...(payload.iframeUrl != null || payload.iframe_url != null\r\n      ? { iframeUrl: hasIframe ? (typeof rawIframe === 'string' ? rawIframe.trim() : rawIframe) : null }\r\n      : {}),\r\n    ...(payload.legende != null ? { legende: payload.legende } : {}),\r\n  };\r\n}\r\n\r\n/**\r\n * Shape attendu:\r\n * {\r\n *   [typologie]: {\r\n *     [periode]: [{ id, titre, descriptionCourte }]\r\n *   }\r\n * }\r\n */\r\nfunction normalizeMenuHistoiresOut(menu = {}) {\r\n  if (!menu || typeof menu !== 'object') return {};\r\n\r\n  const out = {};\r\n  for (const [typologie, periodes] of Object.entries(menu)) {\r\n    const periodesObj = periodes && typeof periodes === 'object' ? periodes : {};\r\n    out[typologie] = {};\r\n\r\n    for (const [periode, items] of Object.entries(periodesObj)) {\r\n      out[typologie][periode] = Array.isArray(items) ? items.map(normalizeMenuItemOut) : [];\r\n    }\r\n  }\r\n  return out;\r\n}\r\n\r\n// ==========================\r\n//        AXIOS INSTANCES\r\n// ==========================\r\n\r\n// Interceptor pour l'instance auth\r\nauthHttp.interceptors.request.use((config) => {\r\n  const token = getToken();\r\n  if (token) {\r\n    config.headers = {\r\n      ...config.headers,\r\n      Authorization: `Bearer ${token}`,\r\n    };\r\n  }\r\n  return config;\r\n});\r\n\r\n// Global response handling (auth)\r\nauthHttp.interceptors.response.use(\r\n  (res) => res,\r\n  (err) => {\r\n    const status = err?.response?.status;\r\n    if (status === 401) dispatchLogout('token_invalid_or_expired');\r\n    logApiError(err);\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\n// Also log public API errors (no logout here)\r\nhttp.interceptors.response.use(\r\n  (res) => res,\r\n  (err) => {\r\n    logApiError(err);\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\n// ==========================\r\n//        ENDPOINTS\r\n// ==========================\r\n\r\n// --- Articles (publics) ---\r\nexport const getArticles = () =>\r\n  http.get(`/articles`).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeArticleOut) : res.data,\r\n  }));\r\n\r\n// Create a new article (authenticated)\r\nexport async function createArticle(payload) {\r\n  const { data } = await authHttp.post(`/articles`, normalizeArticlePayload(payload), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\n// Delete an article (authenticated)\r\nexport async function deleteArticle(id) {\r\n  const res = await authHttp.delete(`/articles/${id}`);\r\n  return res;\r\n}\r\n\r\n// --- Dictionnaire (publics) ---\r\nexport const getDictionary = (params) =>\r\n  http.get(`/dictionnaire`, { params }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeMotOut) : res.data,\r\n  }));\r\n\r\nexport const getThemes = () => http.get(`/dictionnaire/themes`);\r\nexport const getCategories = (theme) => http.get(`/dictionnaire/categories`, { params: { theme } });\r\n\r\n// --- Histoires & Légendes (publics) ---\r\nexport const getHistoires = (params) => http.get(`/histoires`, { params });\r\n\r\n// Keep response shape, but normalize res.data for UI camelCase-only consumption\r\nexport const getMenuHistoires = () =>\r\n  http.get(`/histoires/menu`).then((res) => ({ ...res, data: normalizeMenuHistoiresOut(res.data) }));\r\n\r\nexport const getHistoireById = (id) =>\r\n  http.get(`/histoires/${id}`).then((res) => ({ ...res, data: normalizeHistoireOut(res.data) }));\r\n\r\nexport const findHistoire = (titre) =>\r\n  http.get(`/histoires/find`, { params: { titre } }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeHistoireOut) : res.data,\r\n  }));\r\n\r\nexport const getHistoiresPaged = ({ page, limit }) => http.get(`/histoires/paged`, { params: { page, limit } });\r\n\r\n// --- Histoires (CRUD) (authenticated) ---\r\nexport async function createHistoire(payload) {\r\n  const { data } = await authHttp.post(`/histoires`, payload, {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeHistoireOut(data);\r\n}\r\n\r\nexport async function updateHistoire(id, payload) {\r\n  const { data } = await authHttp.put(`/histoires/${id}`, payload, {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeHistoireOut(data);\r\n}\r\n\r\nexport async function deleteHistoire(id) {\r\n  const res = await authHttp.delete(`/histoires/${id}`);\r\n  return res;\r\n}\r\n\r\n// --- Cartes (Géographie) (public + authenticated mutations) ---\r\nexport const getCartes = (params) =>\r\n  http.get(`/cartes`, { params }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeCarteOut) : res.data,\r\n  }));\r\n\r\nexport async function createCarte(payload) {\r\n  const { data } = await authHttp.post(`/cartes`, normalizeCartePayload(payload), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\nexport async function updateCarte(id, payload) {\r\n  const { data } = await authHttp.put(`/cartes/${id}`, normalizeCartePayload(payload), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\nexport async function deleteCarte(id) {\r\n  const res = await authHttp.delete(`/cartes/${id}`);\r\n  return res;\r\n}\r\n\r\n// ==========================\r\n//   STORED IMAGES (BINARY)\r\n// ==========================\r\n\r\nexport function getArticleImageUrl(id, cacheBuster) {\r\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\r\n  return `${API_BASE}/articles/${id}/image${qs}`;\r\n}\r\n\r\nexport function getCarteImageUrl(id, cacheBuster) {\r\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\r\n  return `${API_BASE}/cartes/${id}/image${qs}`;\r\n}\r\n\r\nexport async function uploadArticleImage(id, file) {\r\n  const fd = new FormData();\r\n  fd.append('image', file);\r\n  const { data } = await authHttp.put(`/articles/${id}/image`, fd);\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\nexport async function deleteArticleImage(id) {\r\n  const { data } = await authHttp.delete(`/articles/${id}/image`);\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\nexport async function uploadCarteImage(id, file) {\r\n  const fd = new FormData();\r\n  fd.append('image', file);\r\n  const { data } = await authHttp.put(`/cartes/${id}/image`, fd);\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\nexport async function deleteCarteImage(id) {\r\n  const { data } = await authHttp.delete(`/cartes/${id}/image`);\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\n// --- Dictionnaire: update d'un mot (ligne du tableau)\r\nexport async function updateMot(id, payload) {\r\n  const { data } = await authHttp.put(\r\n    `/dictionnaire/${id}`,\r\n    normalizeDictionnairePayload(payload),\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  );\r\n  return normalizeMotOut(data);\r\n}\r\n\r\n// --- Articles: update d'une carte/article\r\nexport async function updateArticle(id, payload) {\r\n  const { data } = await authHttp.put(\r\n    `/articles/${id}`,\r\n    normalizeArticlePayload(payload),\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  );\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\n// ==========================\r\n//       AUTH SERVICES\r\n// ==========================\r\n\r\nexport async function login({ username, password }) {\r\n  const params = new URLSearchParams();\r\n  params.append('username', username);\r\n  params.append('password', password);\r\n\r\n  const { data } = await http.post(`/auth/login`, params, {\r\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n  });\r\n\r\n  if (data?.access_token) setToken(data.access_token);\r\n  return data;\r\n}\r\n\r\nexport async function register({ username, password }) {\r\n  const { data } = await http.post(\r\n    `/auth/register`,\r\n    { username, password },\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  );\r\n  return data;\r\n}\r\n\r\n/**\r\n * Récupère l'utilisateur courant (protégé)\r\n * - Nécessite Authorization: Bearer <token>\r\n * - Retour: { username }\r\n */\r\nexport async function getMe() {\r\n  const { data } = await authHttp.get(`/auth/me`);\r\n  return data;\r\n}\r\n\r\n// (Optionnel) helper logout\r\nexport function logout() {\r\n  dispatchLogout('manual');\r\n}\r\n\r\n// ==========================\r\n//    EXPORTS UTILES PAR DÉFAUT\r\n// ==========================\r\nexport const api = http;\r\nexport const apiAuth = authHttp;\r\n\r\n// --- Error handling ---\r\nexport function getApiErrorMessage(err) {\r\n  const status = err?.response?.status;\r\n  const retryAfter = err?.response?.headers?.['retry-after'];\r\n\r\n  const detail = err?.response?.data?.detail;\r\n\r\n  if (detail && typeof detail === 'object') {\r\n    if (typeof detail.message === 'string' && detail.message.trim() !== '') return detail.message;\r\n    if (typeof detail.code === 'string' && detail.code.trim() !== '') return detail.code;\r\n    try {\r\n      return JSON.stringify(detail);\r\n    } catch {\r\n      return 'Erreur API';\r\n    }\r\n  }\r\n\r\n  if (typeof detail === 'string') return detail;\r\n\r\n  const msg = err?.response?.data?.message || err?.message;\r\n  const base = typeof msg === 'string' ? msg : 'Erreur API';\r\n\r\n  if (status === 429 && retryAfter) return `${base} (Retry-After: ${retryAfter}s)`;\r\n  return base;\r\n}\r\n"],"mappings":"AAAA;AACA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,WAAW,QAAQ,iBAAiB;;AAE7C;AACA,MAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,uBAAuB;;AAEzE;AACA;AACA,MAAMC,IAAI,GAAGN,KAAK,CAACO,MAAM,CAAC;EACxBC,OAAO,EAAEN,QAAQ;EACjBO,eAAe,EAAE,IAAI,CAAE;AACzB,CAAC,CAAC;;AAEF;AACA;AACA,MAAMC,QAAQ,GAAGV,KAAK,CAACO,MAAM,CAAC;EAC5BC,OAAO,EAAEN,QAAQ;EACjBO,eAAe,EAAE,IAAI,CAAE;AACzB,CAAC,CAAC;;AAEF;AACA,IAAIE,MAAM,GAAG,IAAI;AAEjB,OAAO,SAASC,QAAQA,CAACC,KAAK,EAAE;EAC9BF,MAAM,GAAGE,KAAK;EACd,IAAIA,KAAK,EAAE;IACT;IACAH,QAAQ,CAACI,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAG,UAAUH,KAAK,EAAE;IACrE,IAAI;MAAEI,MAAM,CAACC,aAAa,CAAC,IAAIC,KAAK,CAAC,YAAY,CAAC,CAAC;IAAE,CAAC,CAAC,MAAM,CAAC;EAChE,CAAC,MAAM;IACL,OAAOT,QAAQ,CAACI,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC;IACxD,IAAI;MAAEC,MAAM,CAACC,aAAa,CAAC,IAAIE,WAAW,CAAC,aAAa,EAAE;QAAEC,MAAM,EAAE;UAAEC,MAAM,EAAE;QAAS;MAAE,CAAC,CAAC,CAAC;IAAE,CAAC,CAAC,MAAM,CAAC;EACzG;AACF;AAEA,OAAO,SAASC,QAAQA,CAAA,EAAG;EACzB,OAAOZ,MAAM;AACf;AAEA,OAAO,SAASa,UAAUA,CAAA,EAAG;EAC3BZ,QAAQ,CAAC,IAAI,CAAC;AAChB;;AAEA;AACA;AACA;AACA,OAAO,SAASa,oBAAoBA,CAACC,GAAG,EAAE;EAAA,IAAAC,aAAA,EAAAC,qBAAA;EACxC,MAAMC,GAAG,GAAGH,GAAG,aAAHA,GAAG,wBAAAC,aAAA,GAAHD,GAAG,CAAEI,QAAQ,cAAAH,aAAA,wBAAAC,qBAAA,GAAbD,aAAA,CAAeZ,OAAO,cAAAa,qBAAA,uBAAtBA,qBAAA,CAAyB,aAAa,CAAC;EACnD,IAAI,CAACC,GAAG,EAAE,OAAO,IAAI;EACrB,MAAME,CAAC,GAAGC,MAAM,CAACH,GAAG,CAAC;EACrB,OAAOG,MAAM,CAACC,QAAQ,CAACF,CAAC,CAAC,IAAIA,CAAC,GAAG,CAAC,GAAGA,CAAC,GAAG,IAAI;AAC/C;AAEA,SAASG,cAAcA,CAACZ,MAAM,GAAG,cAAc,EAAE;EAC/CE,UAAU,CAAC,CAAC;;EAEZ;EACA,IAAI;IACFP,MAAM,CAACC,aAAa,CAAC,IAAIE,WAAW,CAAC,aAAa,EAAE;MAAEC,MAAM,EAAE;QAAEC;MAAO;IAAE,CAAC,CAAC,CAAC;EAC9E,CAAC,CAAC,MAAM;IACN;EAAA;;EAGF;EACA;EACA;EACA;AACF;;AAEA;AACA;AACA;AACA,SAASa,uBAAuBA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAC,cAAA,EAAAC,IAAA,EAAAC,iBAAA,EAAAC,kBAAA;EAC7C;EACA;EACA,OAAO;IACL,IAAIJ,OAAO,CAACK,KAAK,IAAI,IAAI,IAAIL,OAAO,CAACM,KAAK,IAAI,IAAI,GAAG;MAAED,KAAK,GAAAJ,cAAA,GAAED,OAAO,CAACK,KAAK,cAAAJ,cAAA,cAAAA,cAAA,GAAID,OAAO,CAACM;IAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IACpG,IAAIN,OAAO,CAACO,WAAW,IAAI,IAAI,GAAG;MAAEA,WAAW,EAAEP,OAAO,CAACO;IAAY,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5E,IAAIP,OAAO,CAACQ,QAAQ,IAAI,IAAI,IAAIR,OAAO,CAACS,SAAS,IAAI,IAAI,IAAIT,OAAO,CAACU,GAAG,IAAI,IAAI,GAC5E;MAAEF,QAAQ,GAAAN,IAAA,IAAAC,iBAAA,GAAEH,OAAO,CAACQ,QAAQ,cAAAL,iBAAA,cAAAA,iBAAA,GAAIH,OAAO,CAACS,SAAS,cAAAP,IAAA,cAAAA,IAAA,GAAIF,OAAO,CAACU;IAAI,CAAC,GAClE,CAAC,CAAC,CAAC;IACP,IAAIV,OAAO,CAACW,SAAS,IAAI,IAAI,IAAIX,OAAO,CAACY,UAAU,IAAI,IAAI,GAAG;MAAED,SAAS,GAAAP,kBAAA,GAAEJ,OAAO,CAACW,SAAS,cAAAP,kBAAA,cAAAA,kBAAA,GAAIJ,OAAO,CAACY;IAAW,CAAC,GAAG,CAAC,CAAC;EAC3H,CAAC;AACH;AAEA,SAASC,4BAA4BA,CAACb,OAAO,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAc,qBAAA,EAAAC,qBAAA,EAAAC,qBAAA,EAAAC,oBAAA,EAAAC,mBAAA,EAAAC,mBAAA;EAClD;EACA;EACA,OAAO;IACL,IAAInB,OAAO,CAACoB,KAAK,IAAI,IAAI,GAAG;MAAEA,KAAK,EAAEpB,OAAO,CAACoB;IAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IAC1D,IAAIpB,OAAO,CAACqB,SAAS,IAAI,IAAI,GAAG;MAAEA,SAAS,EAAErB,OAAO,CAACqB;IAAU,CAAC,GAAG,CAAC,CAAC,CAAC;IACtE,IAAIrB,OAAO,CAACO,WAAW,IAAI,IAAI,GAAG;MAAEA,WAAW,EAAEP,OAAO,CAACO;IAAY,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5E,IAAIP,OAAO,CAACsB,YAAY,IAAI,IAAI,IAAItB,OAAO,CAACuB,aAAa,IAAI,IAAI,GAAG;MAAED,YAAY,GAAAR,qBAAA,GAAEd,OAAO,CAACsB,YAAY,cAAAR,qBAAA,cAAAA,qBAAA,GAAId,OAAO,CAACuB;IAAc,CAAC,GAAG,CAAC,CAAC,CAAC;IACzI,IAAIvB,OAAO,CAACwB,aAAa,IAAI,IAAI,IAAIxB,OAAO,CAACyB,cAAc,IAAI,IAAI,GAAG;MAAED,aAAa,GAAAT,qBAAA,GAAEf,OAAO,CAACwB,aAAa,cAAAT,qBAAA,cAAAA,qBAAA,GAAIf,OAAO,CAACyB;IAAe,CAAC,GAAG,CAAC,CAAC,CAAC;IAC9I,IAAIzB,OAAO,CAAC0B,iBAAiB,IAAI,IAAI,IAAI1B,OAAO,CAAC2B,kBAAkB,IAAI,IAAI,GAAG;MAAED,iBAAiB,GAAAV,qBAAA,GAAEhB,OAAO,CAAC0B,iBAAiB,cAAAV,qBAAA,cAAAA,qBAAA,GAAIhB,OAAO,CAAC2B;IAAmB,CAAC,GAAG,CAAC,CAAC,CAAC;IAClK,IAAI3B,OAAO,CAAC4B,WAAW,IAAI,IAAI,IAAI5B,OAAO,CAAC6B,YAAY,IAAI,IAAI,GAAG;MAAED,WAAW,GAAAX,oBAAA,GAAEjB,OAAO,CAAC4B,WAAW,cAAAX,oBAAA,cAAAA,oBAAA,GAAIjB,OAAO,CAAC6B;IAAa,CAAC,GAAG,CAAC,CAAC,CAAC;IACpI,IAAI7B,OAAO,CAAC8B,UAAU,IAAI,IAAI,IAAI9B,OAAO,CAAC+B,WAAW,IAAI,IAAI,GAAG;MAAED,UAAU,GAAAZ,mBAAA,GAAElB,OAAO,CAAC8B,UAAU,cAAAZ,mBAAA,cAAAA,mBAAA,GAAIlB,OAAO,CAAC+B;IAAY,CAAC,GAAG,CAAC,CAAC,CAAC;IAC/H,IAAI/B,OAAO,CAACgC,UAAU,IAAI,IAAI,IAAIhC,OAAO,CAACiC,WAAW,IAAI,IAAI,GAAG;MAAED,UAAU,GAAAb,mBAAA,GAAEnB,OAAO,CAACgC,UAAU,cAAAb,mBAAA,cAAAA,mBAAA,GAAInB,OAAO,CAACiC;IAAY,CAAC,GAAG,CAAC,CAAC;EAChI,CAAC;AACH;;AAEA;AACA,SAASC,mBAAmBA,CAACC,CAAC,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAC,KAAA,EAAAC,KAAA,EAAAC,WAAA,EAAAC,KAAA,EAAAC,YAAA,EAAAC,KAAA,EAAAC,cAAA;EACnC,OAAO;IACL,GAAGP,CAAC;IACJ3B,QAAQ,GAAA4B,KAAA,IAAAC,KAAA,IAAAC,WAAA,GAAEH,CAAC,CAAC3B,QAAQ,cAAA8B,WAAA,cAAAA,WAAA,GAAIH,CAAC,CAAC1B,SAAS,cAAA4B,KAAA,cAAAA,KAAA,GAAIF,CAAC,CAACzB,GAAG,cAAA0B,KAAA,cAAAA,KAAA,GAAI,EAAE;IAClDzB,SAAS,GAAA4B,KAAA,IAAAC,YAAA,GAAEL,CAAC,CAACxB,SAAS,cAAA6B,YAAA,cAAAA,YAAA,GAAIL,CAAC,CAACvB,UAAU,cAAA2B,KAAA,cAAAA,KAAA,GAAI,EAAE;IAC5CI,WAAW,GAAAF,KAAA,IAAAC,cAAA,GAAEP,CAAC,CAACQ,WAAW,cAAAD,cAAA,cAAAA,cAAA,GAAIP,CAAC,CAACS,YAAY,cAAAH,KAAA,cAAAA,KAAA,GAAI;EAClD,CAAC;AACH;AAEA,SAASI,eAAeA,CAACC,CAAC,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAC,KAAA,EAAAC,eAAA,EAAAC,KAAA,EAAAC,gBAAA,EAAAC,KAAA,EAAAC,oBAAA,EAAAC,KAAA,EAAAC,cAAA,EAAAC,KAAA,EAAAC,aAAA,EAAAC,KAAA,EAAAC,aAAA;EAC/B,OAAO;IACL,GAAGZ,CAAC;IACJxB,YAAY,GAAAyB,KAAA,IAAAC,eAAA,GAAEF,CAAC,CAACxB,YAAY,cAAA0B,eAAA,cAAAA,eAAA,GAAIF,CAAC,CAACvB,aAAa,cAAAwB,KAAA,cAAAA,KAAA,GAAI,EAAE;IACrDvB,aAAa,GAAAyB,KAAA,IAAAC,gBAAA,GAAEJ,CAAC,CAACtB,aAAa,cAAA0B,gBAAA,cAAAA,gBAAA,GAAIJ,CAAC,CAACrB,cAAc,cAAAwB,KAAA,cAAAA,KAAA,GAAI,EAAE;IACxDvB,iBAAiB,GAAAyB,KAAA,IAAAC,oBAAA,GAAEN,CAAC,CAACpB,iBAAiB,cAAA0B,oBAAA,cAAAA,oBAAA,GAAIN,CAAC,CAACnB,kBAAkB,cAAAwB,KAAA,cAAAA,KAAA,GAAI,EAAE;IACpEvB,WAAW,GAAAyB,KAAA,IAAAC,cAAA,GAAER,CAAC,CAAClB,WAAW,cAAA0B,cAAA,cAAAA,cAAA,GAAIR,CAAC,CAACjB,YAAY,cAAAwB,KAAA,cAAAA,KAAA,GAAI,EAAE;IAClDvB,UAAU,GAAAyB,KAAA,IAAAC,aAAA,GAAEV,CAAC,CAAChB,UAAU,cAAA0B,aAAA,cAAAA,aAAA,GAAIV,CAAC,CAACf,WAAW,cAAAwB,KAAA,cAAAA,KAAA,GAAI,EAAE;IAC/CvB,UAAU,GAAAyB,KAAA,IAAAC,aAAA,GAAEZ,CAAC,CAACd,UAAU,cAAA0B,aAAA,cAAAA,aAAA,GAAIZ,CAAC,CAACb,WAAW,cAAAwB,KAAA,cAAAA,KAAA,GAAI;IAC7C;EACF,CAAC;AACH;;AAEA;AACA,SAASE,oBAAoBA,CAACC,CAAC,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAC,MAAA,EAAAC,oBAAA,EAAAC,MAAA,EAAAC,oBAAA,EAAAC,MAAA,EAAAC,YAAA;EACpC,OAAO;IACL,GAAGN,CAAC;IACJO,iBAAiB,GAAAN,MAAA,IAAAC,oBAAA,GAAEF,CAAC,CAACO,iBAAiB,cAAAL,oBAAA,cAAAA,oBAAA,GAAIF,CAAC,CAACQ,kBAAkB,cAAAP,MAAA,cAAAA,MAAA,GAAI,EAAE;IACpEQ,iBAAiB,GAAAN,MAAA,IAAAC,oBAAA,GAAEJ,CAAC,CAACS,iBAAiB,cAAAL,oBAAA,cAAAA,oBAAA,GAAIJ,CAAC,CAACU,kBAAkB,cAAAP,MAAA,cAAAA,MAAA,GAAI,EAAE;IACpEpD,SAAS,GAAAsD,MAAA,IAAAC,YAAA,GAAEN,CAAC,CAACjD,SAAS,cAAAuD,YAAA,cAAAA,YAAA,GAAIN,CAAC,CAAChD,UAAU,cAAAqD,MAAA,cAAAA,MAAA,GAAI;IAC1C;EACF,CAAC;AACH;AAEA,SAASM,oBAAoBA,CAACC,IAAI,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAC,MAAA,EAAAC,qBAAA;EACvC,OAAO;IACL,GAAGF,IAAI;IACPL,iBAAiB,GAAAM,MAAA,IAAAC,qBAAA,GAAEF,IAAI,CAACL,iBAAiB,cAAAO,qBAAA,cAAAA,qBAAA,GAAIF,IAAI,CAACJ,kBAAkB,cAAAK,MAAA,cAAAA,MAAA,GAAI;EAC1E,CAAC;AACH;;AAEA;AACA,SAASE,iBAAiBA,CAACC,CAAC,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAC,MAAA,EAAAC,YAAA,EAAAC,MAAA,EAAAC,UAAA,EAAAC,MAAA,EAAAC,cAAA;EACjC,OAAO;IACL,GAAGN,CAAC;IACJO,SAAS,GAAAN,MAAA,IAAAC,YAAA,GAAEF,CAAC,CAACO,SAAS,cAAAL,YAAA,cAAAA,YAAA,GAAIF,CAAC,CAACQ,UAAU,cAAAP,MAAA,cAAAA,MAAA,GAAI,EAAE;IAC5C;IACAQ,OAAO,GAAAN,MAAA,IAAAC,UAAA,GAAEJ,CAAC,CAACS,OAAO,cAAAL,UAAA,cAAAA,UAAA,GAAIJ,CAAC,CAACS,OAAO,cAAAN,MAAA,cAAAA,MAAA,GAAI,EAAE;IACrCpC,WAAW,GAAAsC,MAAA,IAAAC,cAAA,GAAEN,CAAC,CAACjC,WAAW,cAAAuC,cAAA,cAAAA,cAAA,GAAIN,CAAC,CAAChC,YAAY,cAAAqC,MAAA,cAAAA,MAAA,GAAI;EAClD,CAAC;AACH;AAEA,SAASK,qBAAqBA,CAACtF,OAAO,GAAG,CAAC,CAAC,EAAE;EAAA,IAAAuF,kBAAA;EAC3C,MAAMC,SAAS,IAAAD,kBAAA,GAAGvF,OAAO,CAACmF,SAAS,cAAAI,kBAAA,cAAAA,kBAAA,GAAIvF,OAAO,CAACoF,UAAU;EACzD,MAAMK,SAAS,GAAG,OAAOD,SAAS,KAAK,QAAQ,GAAGA,SAAS,CAACE,IAAI,CAAC,CAAC,KAAK,EAAE,GAAGF,SAAS,IAAI,IAAI;EAC7F,OAAO;IACL,IAAIxF,OAAO,CAACK,KAAK,IAAI,IAAI,GAAG;MAAEA,KAAK,EAAEL,OAAO,CAACK;IAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IAC1D,IAAIL,OAAO,CAACmF,SAAS,IAAI,IAAI,IAAInF,OAAO,CAACoF,UAAU,IAAI,IAAI,GACvD;MAAED,SAAS,EAAEM,SAAS,GAAI,OAAOD,SAAS,KAAK,QAAQ,GAAGA,SAAS,CAACE,IAAI,CAAC,CAAC,GAAGF,SAAS,GAAI;IAAK,CAAC,GAChG,CAAC,CAAC,CAAC;IACP,IAAIxF,OAAO,CAACqF,OAAO,IAAI,IAAI,GAAG;MAAEA,OAAO,EAAErF,OAAO,CAACqF;IAAQ,CAAC,GAAG,CAAC,CAAC;EACjE,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASM,yBAAyBA,CAACC,IAAI,GAAG,CAAC,CAAC,EAAE;EAC5C,IAAI,CAACA,IAAI,IAAI,OAAOA,IAAI,KAAK,QAAQ,EAAE,OAAO,CAAC,CAAC;EAEhD,MAAMC,GAAG,GAAG,CAAC,CAAC;EACd,KAAK,MAAM,CAACC,SAAS,EAAEC,QAAQ,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACL,IAAI,CAAC,EAAE;IACxD,MAAMM,WAAW,GAAGH,QAAQ,IAAI,OAAOA,QAAQ,KAAK,QAAQ,GAAGA,QAAQ,GAAG,CAAC,CAAC;IAC5EF,GAAG,CAACC,SAAS,CAAC,GAAG,CAAC,CAAC;IAEnB,KAAK,MAAM,CAACK,OAAO,EAAEC,KAAK,CAAC,IAAIJ,MAAM,CAACC,OAAO,CAACC,WAAW,CAAC,EAAE;MAC1DL,GAAG,CAACC,SAAS,CAAC,CAACK,OAAO,CAAC,GAAGE,KAAK,CAACC,OAAO,CAACF,KAAK,CAAC,GAAGA,KAAK,CAACG,GAAG,CAAChC,oBAAoB,CAAC,GAAG,EAAE;IACvF;EACF;EACA,OAAOsB,GAAG;AACZ;;AAEA;AACA;AACA;;AAEA;AACAvH,QAAQ,CAACkI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAEC,MAAM,IAAK;EAC5C,MAAMlI,KAAK,GAAGU,QAAQ,CAAC,CAAC;EACxB,IAAIV,KAAK,EAAE;IACTkI,MAAM,CAAChI,OAAO,GAAG;MACf,GAAGgI,MAAM,CAAChI,OAAO;MACjBiI,aAAa,EAAE,UAAUnI,KAAK;IAChC,CAAC;EACH;EACA,OAAOkI,MAAM;AACf,CAAC,CAAC;;AAEF;AACArI,QAAQ,CAACkI,YAAY,CAAC9G,QAAQ,CAACgH,GAAG,CAC/BG,GAAG,IAAKA,GAAG,EACXvH,GAAG,IAAK;EAAA,IAAAwH,cAAA;EACP,MAAMC,MAAM,GAAGzH,GAAG,aAAHA,GAAG,wBAAAwH,cAAA,GAAHxH,GAAG,CAAEI,QAAQ,cAAAoH,cAAA,uBAAbA,cAAA,CAAeC,MAAM;EACpC,IAAIA,MAAM,KAAK,GAAG,EAAEjH,cAAc,CAAC,0BAA0B,CAAC;EAC9DjC,WAAW,CAACyB,GAAG,CAAC;EAChB,OAAO0H,OAAO,CAACC,MAAM,CAAC3H,GAAG,CAAC;AAC5B,CACF,CAAC;;AAED;AACApB,IAAI,CAACsI,YAAY,CAAC9G,QAAQ,CAACgH,GAAG,CAC3BG,GAAG,IAAKA,GAAG,EACXvH,GAAG,IAAK;EACPzB,WAAW,CAACyB,GAAG,CAAC;EAChB,OAAO0H,OAAO,CAACC,MAAM,CAAC3H,GAAG,CAAC;AAC5B,CACF,CAAC;;AAED;AACA;AACA;;AAEA;AACA,OAAO,MAAM4H,WAAW,GAAGA,CAAA,KACzBhJ,IAAI,CAACiJ,GAAG,CAAC,WAAW,CAAC,CAACC,IAAI,CAAEP,GAAG,KAAM;EACnC,GAAGA,GAAG;EACNQ,IAAI,EAAEhB,KAAK,CAACC,OAAO,CAACO,GAAG,CAACQ,IAAI,CAAC,GAAGR,GAAG,CAACQ,IAAI,CAACd,GAAG,CAACrE,mBAAmB,CAAC,GAAG2E,GAAG,CAACQ;AAC1E,CAAC,CAAC,CAAC;;AAEL;AACA,OAAO,eAAeC,aAAaA,CAACtH,OAAO,EAAE;EAC3C,MAAM;IAAEqH;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACiJ,IAAI,CAAC,WAAW,EAAExH,uBAAuB,CAACC,OAAO,CAAC,EAAE;IAClFrB,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAChD,CAAC,CAAC;EACF,OAAOuD,mBAAmB,CAACmF,IAAI,CAAC;AAClC;;AAEA;AACA,OAAO,eAAeG,aAAaA,CAACC,EAAE,EAAE;EACtC,MAAMZ,GAAG,GAAG,MAAMvI,QAAQ,CAACoJ,MAAM,CAAC,aAAaD,EAAE,EAAE,CAAC;EACpD,OAAOZ,GAAG;AACZ;;AAEA;AACA,OAAO,MAAMc,aAAa,GAAIC,MAAM,IAClC1J,IAAI,CAACiJ,GAAG,CAAC,eAAe,EAAE;EAAES;AAAO,CAAC,CAAC,CAACR,IAAI,CAAEP,GAAG,KAAM;EACnD,GAAGA,GAAG;EACNQ,IAAI,EAAEhB,KAAK,CAACC,OAAO,CAACO,GAAG,CAACQ,IAAI,CAAC,GAAGR,GAAG,CAACQ,IAAI,CAACd,GAAG,CAAC1D,eAAe,CAAC,GAAGgE,GAAG,CAACQ;AACtE,CAAC,CAAC,CAAC;AAEL,OAAO,MAAMQ,SAAS,GAAGA,CAAA,KAAM3J,IAAI,CAACiJ,GAAG,CAAC,sBAAsB,CAAC;AAC/D,OAAO,MAAMW,aAAa,GAAI1G,KAAK,IAAKlD,IAAI,CAACiJ,GAAG,CAAC,0BAA0B,EAAE;EAAES,MAAM,EAAE;IAAExG;EAAM;AAAE,CAAC,CAAC;;AAEnG;AACA,OAAO,MAAM2G,YAAY,GAAIH,MAAM,IAAK1J,IAAI,CAACiJ,GAAG,CAAC,YAAY,EAAE;EAAES;AAAO,CAAC,CAAC;;AAE1E;AACA,OAAO,MAAMI,gBAAgB,GAAGA,CAAA,KAC9B9J,IAAI,CAACiJ,GAAG,CAAC,iBAAiB,CAAC,CAACC,IAAI,CAAEP,GAAG,KAAM;EAAE,GAAGA,GAAG;EAAEQ,IAAI,EAAE1B,yBAAyB,CAACkB,GAAG,CAACQ,IAAI;AAAE,CAAC,CAAC,CAAC;AAEpG,OAAO,MAAMY,eAAe,GAAIR,EAAE,IAChCvJ,IAAI,CAACiJ,GAAG,CAAC,cAAcM,EAAE,EAAE,CAAC,CAACL,IAAI,CAAEP,GAAG,KAAM;EAAE,GAAGA,GAAG;EAAEQ,IAAI,EAAE1D,oBAAoB,CAACkD,GAAG,CAACQ,IAAI;AAAE,CAAC,CAAC,CAAC;AAEhG,OAAO,MAAMa,YAAY,GAAI7H,KAAK,IAChCnC,IAAI,CAACiJ,GAAG,CAAC,iBAAiB,EAAE;EAAES,MAAM,EAAE;IAAEvH;EAAM;AAAE,CAAC,CAAC,CAAC+G,IAAI,CAAEP,GAAG,KAAM;EAChE,GAAGA,GAAG;EACNQ,IAAI,EAAEhB,KAAK,CAACC,OAAO,CAACO,GAAG,CAACQ,IAAI,CAAC,GAAGR,GAAG,CAACQ,IAAI,CAACd,GAAG,CAAC5C,oBAAoB,CAAC,GAAGkD,GAAG,CAACQ;AAC3E,CAAC,CAAC,CAAC;AAEL,OAAO,MAAMc,iBAAiB,GAAGA,CAAC;EAAEC,IAAI;EAAEC;AAAM,CAAC,KAAKnK,IAAI,CAACiJ,GAAG,CAAC,kBAAkB,EAAE;EAAES,MAAM,EAAE;IAAEQ,IAAI;IAAEC;EAAM;AAAE,CAAC,CAAC;;AAE/G;AACA,OAAO,eAAeC,cAAcA,CAACtI,OAAO,EAAE;EAC5C,MAAM;IAAEqH;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACiJ,IAAI,CAAC,YAAY,EAAEvH,OAAO,EAAE;IAC1DrB,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAChD,CAAC,CAAC;EACF,OAAOgF,oBAAoB,CAAC0D,IAAI,CAAC;AACnC;AAEA,OAAO,eAAekB,cAAcA,CAACd,EAAE,EAAEzH,OAAO,EAAE;EAChD,MAAM;IAAEqH;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACkK,GAAG,CAAC,cAAcf,EAAE,EAAE,EAAEzH,OAAO,EAAE;IAC/DrB,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAChD,CAAC,CAAC;EACF,OAAOgF,oBAAoB,CAAC0D,IAAI,CAAC;AACnC;AAEA,OAAO,eAAeoB,cAAcA,CAAChB,EAAE,EAAE;EACvC,MAAMZ,GAAG,GAAG,MAAMvI,QAAQ,CAACoJ,MAAM,CAAC,cAAcD,EAAE,EAAE,CAAC;EACrD,OAAOZ,GAAG;AACZ;;AAEA;AACA,OAAO,MAAM6B,SAAS,GAAId,MAAM,IAC9B1J,IAAI,CAACiJ,GAAG,CAAC,SAAS,EAAE;EAAES;AAAO,CAAC,CAAC,CAACR,IAAI,CAAEP,GAAG,KAAM;EAC7C,GAAGA,GAAG;EACNQ,IAAI,EAAEhB,KAAK,CAACC,OAAO,CAACO,GAAG,CAACQ,IAAI,CAAC,GAAGR,GAAG,CAACQ,IAAI,CAACd,GAAG,CAAC5B,iBAAiB,CAAC,GAAGkC,GAAG,CAACQ;AACxE,CAAC,CAAC,CAAC;AAEL,OAAO,eAAesB,WAAWA,CAAC3I,OAAO,EAAE;EACzC,MAAM;IAAEqH;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACiJ,IAAI,CAAC,SAAS,EAAEjC,qBAAqB,CAACtF,OAAO,CAAC,EAAE;IAC9ErB,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAChD,CAAC,CAAC;EACF,OAAOgG,iBAAiB,CAAC0C,IAAI,CAAC;AAChC;AAEA,OAAO,eAAeuB,WAAWA,CAACnB,EAAE,EAAEzH,OAAO,EAAE;EAC7C,MAAM;IAAEqH;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACkK,GAAG,CAAC,WAAWf,EAAE,EAAE,EAAEnC,qBAAqB,CAACtF,OAAO,CAAC,EAAE;IACnFrB,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAChD,CAAC,CAAC;EACF,OAAOgG,iBAAiB,CAAC0C,IAAI,CAAC;AAChC;AAEA,OAAO,eAAewB,WAAWA,CAACpB,EAAE,EAAE;EACpC,MAAMZ,GAAG,GAAG,MAAMvI,QAAQ,CAACoJ,MAAM,CAAC,WAAWD,EAAE,EAAE,CAAC;EAClD,OAAOZ,GAAG;AACZ;;AAEA;AACA;AACA;;AAEA,OAAO,SAASiC,kBAAkBA,CAACrB,EAAE,EAAEsB,WAAW,EAAE;EAClD,MAAMC,EAAE,GAAGD,WAAW,GAAG,MAAME,kBAAkB,CAACC,MAAM,CAACH,WAAW,CAAC,CAAC,EAAE,GAAG,EAAE;EAC7E,OAAO,GAAGjL,QAAQ,aAAa2J,EAAE,SAASuB,EAAE,EAAE;AAChD;AAEA,OAAO,SAASG,gBAAgBA,CAAC1B,EAAE,EAAEsB,WAAW,EAAE;EAChD,MAAMC,EAAE,GAAGD,WAAW,GAAG,MAAME,kBAAkB,CAACC,MAAM,CAACH,WAAW,CAAC,CAAC,EAAE,GAAG,EAAE;EAC7E,OAAO,GAAGjL,QAAQ,WAAW2J,EAAE,SAASuB,EAAE,EAAE;AAC9C;AAEA,OAAO,eAAeI,kBAAkBA,CAAC3B,EAAE,EAAE4B,IAAI,EAAE;EACjD,MAAMC,EAAE,GAAG,IAAIC,QAAQ,CAAC,CAAC;EACzBD,EAAE,CAACE,MAAM,CAAC,OAAO,EAAEH,IAAI,CAAC;EACxB,MAAM;IAAEhC;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACkK,GAAG,CAAC,aAAaf,EAAE,QAAQ,EAAE6B,EAAE,CAAC;EAChE,OAAOpH,mBAAmB,CAACmF,IAAI,CAAC;AAClC;AAEA,OAAO,eAAeoC,kBAAkBA,CAAChC,EAAE,EAAE;EAC3C,MAAM;IAAEJ;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACoJ,MAAM,CAAC,aAAaD,EAAE,QAAQ,CAAC;EAC/D,OAAOvF,mBAAmB,CAACmF,IAAI,CAAC;AAClC;AAEA,OAAO,eAAeqC,gBAAgBA,CAACjC,EAAE,EAAE4B,IAAI,EAAE;EAC/C,MAAMC,EAAE,GAAG,IAAIC,QAAQ,CAAC,CAAC;EACzBD,EAAE,CAACE,MAAM,CAAC,OAAO,EAAEH,IAAI,CAAC;EACxB,MAAM;IAAEhC;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACkK,GAAG,CAAC,WAAWf,EAAE,QAAQ,EAAE6B,EAAE,CAAC;EAC9D,OAAO3E,iBAAiB,CAAC0C,IAAI,CAAC;AAChC;AAEA,OAAO,eAAesC,gBAAgBA,CAAClC,EAAE,EAAE;EACzC,MAAM;IAAEJ;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACoJ,MAAM,CAAC,WAAWD,EAAE,QAAQ,CAAC;EAC7D,OAAO9C,iBAAiB,CAAC0C,IAAI,CAAC;AAChC;;AAEA;AACA,OAAO,eAAeuC,SAASA,CAACnC,EAAE,EAAEzH,OAAO,EAAE;EAC3C,MAAM;IAAEqH;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACkK,GAAG,CACjC,iBAAiBf,EAAE,EAAE,EACrB5G,4BAA4B,CAACb,OAAO,CAAC,EACrC;IAAErB,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAAE,CACpD,CAAC;EACD,OAAOkE,eAAe,CAACwE,IAAI,CAAC;AAC9B;;AAEA;AACA,OAAO,eAAewC,aAAaA,CAACpC,EAAE,EAAEzH,OAAO,EAAE;EAC/C,MAAM;IAAEqH;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAACkK,GAAG,CACjC,aAAaf,EAAE,EAAE,EACjB1H,uBAAuB,CAACC,OAAO,CAAC,EAChC;IAAErB,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAAE,CACpD,CAAC;EACD,OAAOuD,mBAAmB,CAACmF,IAAI,CAAC;AAClC;;AAEA;AACA;AACA;;AAEA,OAAO,eAAeyC,KAAKA,CAAC;EAAEC,QAAQ;EAAEC;AAAS,CAAC,EAAE;EAClD,MAAMpC,MAAM,GAAG,IAAIqC,eAAe,CAAC,CAAC;EACpCrC,MAAM,CAAC4B,MAAM,CAAC,UAAU,EAAEO,QAAQ,CAAC;EACnCnC,MAAM,CAAC4B,MAAM,CAAC,UAAU,EAAEQ,QAAQ,CAAC;EAEnC,MAAM;IAAE3C;EAAK,CAAC,GAAG,MAAMnJ,IAAI,CAACqJ,IAAI,CAAC,aAAa,EAAEK,MAAM,EAAE;IACtDjJ,OAAO,EAAE;MAAE,cAAc,EAAE;IAAoC;EACjE,CAAC,CAAC;EAEF,IAAI0I,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAE6C,YAAY,EAAE1L,QAAQ,CAAC6I,IAAI,CAAC6C,YAAY,CAAC;EACnD,OAAO7C,IAAI;AACb;AAEA,OAAO,eAAe8C,QAAQA,CAAC;EAAEJ,QAAQ;EAAEC;AAAS,CAAC,EAAE;EACrD,MAAM;IAAE3C;EAAK,CAAC,GAAG,MAAMnJ,IAAI,CAACqJ,IAAI,CAC9B,gBAAgB,EAChB;IAAEwC,QAAQ;IAAEC;EAAS,CAAC,EACtB;IAAErL,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAAE,CACpD,CAAC;EACD,OAAO0I,IAAI;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,eAAe+C,KAAKA,CAAA,EAAG;EAC5B,MAAM;IAAE/C;EAAK,CAAC,GAAG,MAAM/I,QAAQ,CAAC6I,GAAG,CAAC,UAAU,CAAC;EAC/C,OAAOE,IAAI;AACb;;AAEA;AACA,OAAO,SAASgD,MAAMA,CAAA,EAAG;EACvBvK,cAAc,CAAC,QAAQ,CAAC;AAC1B;;AAEA;AACA;AACA;AACA,OAAO,MAAMwK,GAAG,GAAGpM,IAAI;AACvB,OAAO,MAAMqM,OAAO,GAAGjM,QAAQ;;AAE/B;AACA,OAAO,SAASkM,kBAAkBA,CAAClL,GAAG,EAAE;EAAA,IAAAmL,cAAA,EAAAC,cAAA,EAAAC,qBAAA,EAAAC,cAAA,EAAAC,mBAAA,EAAAC,cAAA,EAAAC,mBAAA;EACtC,MAAMhE,MAAM,GAAGzH,GAAG,aAAHA,GAAG,wBAAAmL,cAAA,GAAHnL,GAAG,CAAEI,QAAQ,cAAA+K,cAAA,uBAAbA,cAAA,CAAe1D,MAAM;EACpC,MAAMiE,UAAU,GAAG1L,GAAG,aAAHA,GAAG,wBAAAoL,cAAA,GAAHpL,GAAG,CAAEI,QAAQ,cAAAgL,cAAA,wBAAAC,qBAAA,GAAbD,cAAA,CAAe/L,OAAO,cAAAgM,qBAAA,uBAAtBA,qBAAA,CAAyB,aAAa,CAAC;EAE1D,MAAM1L,MAAM,GAAGK,GAAG,aAAHA,GAAG,wBAAAsL,cAAA,GAAHtL,GAAG,CAAEI,QAAQ,cAAAkL,cAAA,wBAAAC,mBAAA,GAAbD,cAAA,CAAevD,IAAI,cAAAwD,mBAAA,uBAAnBA,mBAAA,CAAqB5L,MAAM;EAE1C,IAAIA,MAAM,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;IACxC,IAAI,OAAOA,MAAM,CAACgM,OAAO,KAAK,QAAQ,IAAIhM,MAAM,CAACgM,OAAO,CAACvF,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,OAAOzG,MAAM,CAACgM,OAAO;IAC7F,IAAI,OAAOhM,MAAM,CAACiM,IAAI,KAAK,QAAQ,IAAIjM,MAAM,CAACiM,IAAI,CAACxF,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,OAAOzG,MAAM,CAACiM,IAAI;IACpF,IAAI;MACF,OAAOC,IAAI,CAACC,SAAS,CAACnM,MAAM,CAAC;IAC/B,CAAC,CAAC,MAAM;MACN,OAAO,YAAY;IACrB;EACF;EAEA,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE,OAAOA,MAAM;EAE7C,MAAMoM,GAAG,GAAG,CAAA/L,GAAG,aAAHA,GAAG,wBAAAwL,cAAA,GAAHxL,GAAG,CAAEI,QAAQ,cAAAoL,cAAA,wBAAAC,mBAAA,GAAbD,cAAA,CAAezD,IAAI,cAAA0D,mBAAA,uBAAnBA,mBAAA,CAAqBE,OAAO,MAAI3L,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAE2L,OAAO;EACxD,MAAMK,IAAI,GAAG,OAAOD,GAAG,KAAK,QAAQ,GAAGA,GAAG,GAAG,YAAY;EAEzD,IAAItE,MAAM,KAAK,GAAG,IAAIiE,UAAU,EAAE,OAAO,GAAGM,IAAI,kBAAkBN,UAAU,IAAI;EAChF,OAAOM,IAAI;AACb","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}