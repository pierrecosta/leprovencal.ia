{"ast":null,"code":"// services/api.js\nimport axios from 'axios';\n\n// ===== Base URL via .env (CRA) =====\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n\n// ===== Instance axios par défaut =====\n// On garde une instance \"publiques\" pour compat (GET publiques existantes)\nconst http = axios.create({\n  baseURL: API_BASE\n});\n\n// ===== Instance axios avec auth =====\n// Cette instance attache automatiquement le token s'il est présent\nconst authHttp = axios.create({\n  baseURL: API_BASE\n});\n\n// --- Token management ---\nconst TOKEN_KEY = 'access_token';\nexport function setToken(token) {\n  localStorage.setItem(TOKEN_KEY, token);\n}\nexport function getToken() {\n  return localStorage.getItem(TOKEN_KEY);\n}\nexport function clearToken() {\n  localStorage.removeItem(TOKEN_KEY);\n}\n\n// Interceptor pour l'instance auth\nauthHttp.interceptors.request.use(config => {\n  const token = getToken();\n  if (token) {\n    config.headers = {\n      ...config.headers,\n      Authorization: `Bearer ${token}`\n    };\n  }\n  return config;\n});\n\n// ==========================\n//        ENDPOINTS\n// ==========================\n\n// --- Articles (publics) ---\nexport const getArticles = () => http.get(`/articles`);\n\n// --- Dictionnaire (publics) ---\nexport const getDictionary = params => http.get(`/dictionnaire`, {\n  params\n});\nexport const getThemes = () => http.get(`/dictionnaire/themes`);\nexport const getCategories = theme => http.get(`/dictionnaire/categories`, {\n  params: {\n    theme\n  }\n});\n\n// --- Histoires & Légendes (publics) ---\nexport const getHistoires = params => http.get(`/histoires`, {\n  params\n});\nexport const getMenuHistoires = () => http.get(`/histoires/menu`);\nexport const getHistoireById = id => http.get(`/histoires/${id}`);\nexport const findHistoire = titre => http.get(`/histoires/find`, {\n  params: {\n    titre: encodeURIComponent(titre)\n  }\n});\nexport const getHistoiresPaged = ({\n  page,\n  limit\n}) => http.get(`/histoires/paged`, {\n  params: {\n    page,\n    limit\n  }\n});\n\n// ==========================\n//    UPDATED SERVICES\n// ==========================\n\n// --- Dictionnaire: update d'un mot (ligne du tableau)\nexport async function updateMot(id, payload) {\n  // payload: { theme?, categorie?, mots_francais?, mots_provencal?, description?, synonymes_francais?, eg_provencal?, d_provencal?, a_provencal? }\n  const {\n    data\n  } = await apiAuth.put(`/dictionnaire/${id}`, payload, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return data;\n}\n\n// --- Articles: update d'une carte/article\nexport async function updateArticle(id, payload) {\n  // payload: { title?, src?, ... }\n  const {\n    data\n  } = await apiAuth.put(`/articles/${id}`, payload, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return data;\n}\n\n// ==========================\n//       AUTH SERVICES\n// ==========================\n\n/**\r\n * Login (FastAPI OAuth2PasswordRequestForm)\r\n * - Content-Type: application/x-www-form-urlencoded\r\n * - Retour: { access_token, token_type }\r\n */\nexport async function login({\n  username,\n  password\n}) {\n  const params = new URLSearchParams();\n  params.append('username', username);\n  params.append('password', password);\n  const {\n    data\n  } = await axios.post(`${API_BASE}/auth/login`, params, {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    }\n  });\n  if (data !== null && data !== void 0 && data.access_token) {\n    setToken(data.access_token);\n  }\n  return data;\n}\n\n/**\r\n * Register (JSON UserCreate)\r\n * - Body: { username, password }\r\n * - Retour: UserResponse (défini côté FastAPI)\r\n */\nexport async function register({\n  username,\n  password\n}) {\n  const {\n    data\n  } = await axios.post(`${API_BASE}/auth/register`, {\n    username,\n    password\n  }, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return data;\n}\n\n/**\r\n * Récupère l'utilisateur courant (protégé)\r\n * - Nécessite Authorization: Bearer <token>\r\n * - Retour: { username }\r\n */\nexport async function getMe() {\n  const {\n    data\n  } = await authHttp.get(`/auth/me`);\n  return data;\n}\n\n// (Optionnel) helper logout\nexport function logout() {\n  clearToken();\n}\n\n// ==========================\n//    EXPORTS UTILES PAR DÉFAUT\n// ==========================\nexport const api = http; // instance publique\nexport const apiAuth = authHttp; // instance avec interceptor Bearer","map":{"version":3,"names":["axios","API_BASE","process","env","REACT_APP_API_URL","http","create","baseURL","authHttp","TOKEN_KEY","setToken","token","localStorage","setItem","getToken","getItem","clearToken","removeItem","interceptors","request","use","config","headers","Authorization","getArticles","get","getDictionary","params","getThemes","getCategories","theme","getHistoires","getMenuHistoires","getHistoireById","id","findHistoire","titre","encodeURIComponent","getHistoiresPaged","page","limit","updateMot","payload","data","apiAuth","put","updateArticle","login","username","password","URLSearchParams","append","post","access_token","register","getMe","logout","api"],"sources":["/mnt/c/code/leprovencal.ia/frontend/src/services/api.js"],"sourcesContent":["\r\n// services/api.js\r\nimport axios from 'axios';\r\n\r\n// ===== Base URL via .env (CRA) =====\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:8000';\r\n\r\n// ===== Instance axios par défaut =====\r\n// On garde une instance \"publiques\" pour compat (GET publiques existantes)\r\nconst http = axios.create({\r\n  baseURL: API_BASE,\r\n});\r\n\r\n// ===== Instance axios avec auth =====\r\n// Cette instance attache automatiquement le token s'il est présent\r\nconst authHttp = axios.create({\r\n  baseURL: API_BASE,\r\n});\r\n\r\n// --- Token management ---\r\nconst TOKEN_KEY = 'access_token';\r\n\r\nexport function setToken(token) {\r\n  localStorage.setItem(TOKEN_KEY, token);\r\n}\r\n\r\nexport function getToken() {\r\n  return localStorage.getItem(TOKEN_KEY);\r\n}\r\n\r\nexport function clearToken() {\r\n  localStorage.removeItem(TOKEN_KEY);\r\n}\r\n\r\n// Interceptor pour l'instance auth\r\nauthHttp.interceptors.request.use((config) => {\r\n  const token = getToken();\r\n  if (token) {\r\n    config.headers = {\r\n      ...config.headers,\r\n      Authorization: `Bearer ${token}`,\r\n    };\r\n  }\r\n  return config;\r\n});\r\n\r\n// ==========================\r\n//        ENDPOINTS\r\n// ==========================\r\n\r\n// --- Articles (publics) ---\r\nexport const getArticles = () => http.get(`/articles`);\r\n\r\n// --- Dictionnaire (publics) ---\r\nexport const getDictionary = (params) => http.get(`/dictionnaire`, { params });\r\nexport const getThemes = () => http.get(`/dictionnaire/themes`);\r\nexport const getCategories = (theme) =>\r\n  http.get(`/dictionnaire/categories`, { params: { theme } });\r\n\r\n// --- Histoires & Légendes (publics) ---\r\nexport const getHistoires = (params) => http.get(`/histoires`, { params });\r\nexport const getMenuHistoires = () => http.get(`/histoires/menu`);\r\nexport const getHistoireById = (id) => http.get(`/histoires/${id}`);\r\nexport const findHistoire = (titre) =>\r\n  http.get(`/histoires/find`, { params: { titre: encodeURIComponent(titre) } });\r\n\r\nexport const getHistoiresPaged = ({ page, limit }) =>\r\n  http.get(`/histoires/paged`, { params: { page, limit } });\r\n\r\n// ==========================\r\n//    UPDATED SERVICES\r\n// ==========================\r\n\r\n// --- Dictionnaire: update d'un mot (ligne du tableau)\r\nexport async function updateMot(id, payload) {\r\n  // payload: { theme?, categorie?, mots_francais?, mots_provencal?, description?, synonymes_francais?, eg_provencal?, d_provencal?, a_provencal? }\r\n  const { data } = await apiAuth.put(`/dictionnaire/${id}`, payload, {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return data;\r\n}\r\n\r\n// --- Articles: update d'une carte/article\r\nexport async function updateArticle(id, payload) {\r\n  // payload: { title?, src?, ... }\r\n  const { data } = await apiAuth.put(`/articles/${id}`, payload, {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return data;\r\n}\r\n\r\n// ==========================\r\n//       AUTH SERVICES\r\n// ==========================\r\n\r\n/**\r\n * Login (FastAPI OAuth2PasswordRequestForm)\r\n * - Content-Type: application/x-www-form-urlencoded\r\n * - Retour: { access_token, token_type }\r\n */\r\nexport async function login({ username, password }) {\r\n  const params = new URLSearchParams();\r\n  params.append('username', username);\r\n  params.append('password', password);\r\n\r\n  const { data } = await axios.post(`${API_BASE}/auth/login`, params, {\r\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n  });\r\n\r\n  if (data?.access_token) {\r\n    setToken(data.access_token);\r\n  }\r\n  return data;\r\n}\r\n\r\n/**\r\n * Register (JSON UserCreate)\r\n * - Body: { username, password }\r\n * - Retour: UserResponse (défini côté FastAPI)\r\n */\r\nexport async function register({ username, password }) {\r\n  const { data } = await axios.post(\r\n    `${API_BASE}/auth/register`,\r\n    { username, password },\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  );\r\n  return data;\r\n}\r\n\r\n/**\r\n * Récupère l'utilisateur courant (protégé)\r\n * - Nécessite Authorization: Bearer <token>\r\n * - Retour: { username }\r\n */\r\nexport async function getMe() {\r\n  const { data } = await authHttp.get(`/auth/me`);\r\n  return data;\r\n}\r\n\r\n// (Optionnel) helper logout\r\nexport function logout() {\r\n  clearToken();\r\n}\r\n\r\n// ==========================\r\n//    EXPORTS UTILES PAR DÉFAUT\r\n// ==========================\r\nexport const api = http;     // instance publique\r\nexport const apiAuth = authHttp; // instance avec interceptor Bearer\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}