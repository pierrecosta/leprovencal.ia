{"ast":null,"code":"import _objectSpread from\"/mnt/c/code/leprovencal.ia/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useMemo,useState}from'react';import ApiAlert from'../components/ApiAlert';import Loader from'../components/Loader';import{useAuth}from'../hooks/useAuth';import{createCarte,deleteCarte,deleteCarteImage,getCarteImageUrl,getCartesPaged,updateCarte,uploadCarteImage,getApiErrorMessage,getApiErrorField}from'../services/api';import usePagination from'../hooks/usePagination';import{logError}from'../utils/logger';import{toastError,toastSuccess}from'../utils/notify';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MAX_IMAGE_BYTES=2*1024*1024;export default function GeographyPage(){const{user,ready}=useAuth();const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[fieldErrors,setFieldErrors]=useState({});const[items,setItems]=useState([]);const{page,setPage}=usePagination(1,1);const[hasNext,setHasNext]=useState(false);const[imgRevById,setImgRevById]=useState({});const[createForm,setCreateForm]=useState({titre:'',iframeUrl:'',legende:''});const[createImageFile,setCreateImageFile]=useState(null);const[creating,setCreating]=useState(false);const[editingId,setEditingId]=useState(null);const[editForm,setEditForm]=useState({titre:'',iframeUrl:'',legende:''});const[editImageFile,setEditImageFile]=useState(null);const isLoggedIn=useMemo(()=>Boolean(ready&&user),[ready,user]);const fetchCartes=async()=>{setLoading(true);setError('');try{// request limit+1 to detect next page\nconst res=await getCartesPaged({page,limit:6});const items=Array.isArray(res.data)?res.data:[];// default: show first 5\nsetItems(items.slice(0,5));setHasNext(items.length>5);}catch(err){logError(err);const msg=\"Impossible de charger les cartes.\";setError(msg);toastError(msg);}finally{setLoading(false);}};useEffect(()=>{fetchCartes();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[page]);const startEdit=carte=>{var _carte$titre,_carte$iframeUrl,_carte$legende;setEditingId(carte.id);setEditForm({titre:(_carte$titre=carte.titre)!==null&&_carte$titre!==void 0?_carte$titre:'',iframeUrl:(_carte$iframeUrl=carte.iframeUrl)!==null&&_carte$iframeUrl!==void 0?_carte$iframeUrl:'',legende:(_carte$legende=carte.legende)!==null&&_carte$legende!==void 0?_carte$legende:''});setEditImageFile(null);setFieldErrors({});};const cancelEdit=()=>{setEditingId(null);setEditForm({titre:'',iframeUrl:'',legende:''});setEditImageFile(null);setFieldErrors({});};const saveEdit=async()=>{if(!editingId)return;setError('');setFieldErrors({});// Validate iframe URL against whitelist\nconst isAllowedIframe=raw=>{if(!raw)return true;try{const u=new URL(raw);if(!['http:','https:'].includes(u.protocol))return false;// allow only localhost with ports 3000 or 8000\nif(u.hostname==='localhost'&&['3000','8000'].includes(u.port))return true;return false;}catch(_unused){return false;}};if(editForm!==null&&editForm!==void 0&&editForm.iframeUrl&&!isAllowedIframe(editForm.iframeUrl))return setError('Iframe URL non autorisée (localhost:3000 ou localhost:8000 uniquement).');try{let updated=await updateCarte(editingId,editForm);if(editImageFile){updated=await uploadCarteImage(editingId,editImageFile);setImgRevById(m=>_objectSpread(_objectSpread({},m),{},{[editingId]:(m[editingId]||0)+1}));setEditImageFile(null);}setItems(prev=>prev.map(c=>c.id===editingId?updated:c));cancelEdit();}catch(err){logError(err);const msg=getApiErrorMessage(err);setError(msg||\"Impossible de modifier la carte.\");toastError(msg||\"Impossible de modifier la carte.\");const field=getApiErrorField(err);if(field)setFieldErrors({[field]:msg});}};const remove=async id=>{const ok=window.confirm('Supprimer cette carte ?');if(!ok)return;setError('');setFieldErrors({});try{await deleteCarte(id);setItems(prev=>prev.filter(c=>c.id!==id));if(editingId===id)cancelEdit();toastSuccess('Carte supprimée.');}catch(err){logError(err);const msg=getApiErrorMessage(err);setError(msg||\"Impossible de supprimer la carte.\");toastError(msg||\"Impossible de supprimer la carte.\");}};const submitCreate=async e=>{e.preventDefault();setError('');setFieldErrors({});const titre=(createForm.titre||'').trim();const iframeUrl=(createForm.iframeUrl||'').trim();if(!titre)return setError('Le titre est obligatoire.');// Validate iframe url whitelist\nconst isAllowedIframe=raw=>{if(!raw)return true;try{const u=new URL(raw);if(!['http:','https:'].includes(u.protocol))return false;if(u.hostname==='localhost'&&['3000','8000'].includes(u.port))return true;return false;}catch(_unused2){return false;}};if(!iframeUrl&&!createImageFile)return setError('Il faut une iframe URL ou une image.');if(iframeUrl&&!isAllowedIframe(iframeUrl))return setError('Iframe URL non autorisée (localhost:3000 ou localhost:8000 uniquement).');try{let created=await createCarte(createForm);if(createImageFile){try{created=await uploadCarteImage(created.id,createImageFile);setImgRevById(m=>_objectSpread(_objectSpread({},m),{},{[created.id]:(m[created.id]||0)+1}));}catch(uploadErr){// Avoid leaving a carte without iframe nor image\nif(!iframeUrl){try{await deleteCarte(created.id);}catch(_unused3){// ignore\n}}throw uploadErr;}}setItems(prev=>[created,...prev]);setCreateForm({titre:'',iframeUrl:'',legende:''});setCreateImageFile(null);setCreating(false);toastSuccess('Carte créée.');}catch(err){logError(err);const msg=getApiErrorMessage(err);setError(msg||\"Impossible de créer la carte.\");toastError(msg||\"Impossible de créer la carte.\");const field=getApiErrorField(err);if(field)setFieldErrors({[field]:msg});}};return/*#__PURE__*/_jsxs(\"main\",{className:\"max-w-6xl mx-auto p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold text-[var(--color-lavender)] mb-4\",children:\"Cartes\"}),error&&/*#__PURE__*/_jsx(ApiAlert,{message:error,kind:\"error\",className:\"mb-4\"}),isLoggedIn&&/*#__PURE__*/_jsxs(\"section\",{className:\"mb-6 border rounded bg-white shadow-sm\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"px-4 py-3 border-b bg-[var(--bg)] flex items-center justify-between gap-2\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold text-xl text-[var(--color-lavender)]\",children:\"Gestion (loggu\\xE9)\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>setCreating(v=>!v),type:\"button\",children:creating?'Fermer':'Ajouter une carte'})]}),creating&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitCreate,className:\"p-4 grid md:grid-cols-3 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"Titre *\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",required:true,value:createForm.titre,onChange:e=>setCreateForm(f=>_objectSpread(_objectSpread({},f),{},{titre:e.target.value}))}),fieldErrors.titre&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-600 text-sm mt-1\",children:fieldErrors.titre})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"Iframe URL (optionnel si image)\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:createForm.iframeUrl,onChange:e=>setCreateForm(f=>_objectSpread(_objectSpread({},f),{},{iframeUrl:e.target.value}))}),fieldErrors.iframeUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-600 text-sm mt-1\",children:fieldErrors.iframeUrl})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"L\\xE9gende\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:createForm.legende,onChange:e=>setCreateForm(f=>_objectSpread(_objectSpread({},f),{},{legende:e.target.value}))}),fieldErrors.legende&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-600 text-sm mt-1\",children:fieldErrors.legende})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"Image (fichier) (optionnel, < 2Mo)\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",type:\"file\",accept:\"image/*\",onChange:e=>{var _e$target$files;const f=((_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0])||null;if(!f){setCreateImageFile(null);return;}if(f.size>MAX_IMAGE_BYTES){e.target.value='';setCreateImageFile(null);return;}setCreateImageFile(f);}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"md:col-span-3\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"Cr\\xE9er\"})})]})]}),loading?/*#__PURE__*/_jsx(Loader,{message:\"Chargement des cartes...\"}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:items.map(carte=>/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg overflow-hidden shadow-sm bg-white\",children:[carte.imageStored?/*#__PURE__*/_jsx(\"img\",{src:getCarteImageUrl(carte.id,imgRevById[carte.id]||0),alt:\"Illustration de \".concat(carte.titre),loading:\"lazy\",className:\"w-full h-[320px] md:h-[400px] object-cover\"}):carte.iframeUrl?/*#__PURE__*/_jsx(\"iframe\",{src:carte.iframeUrl,title:carte.titre,loading:\"lazy\",referrerPolicy:\"no-referrer\",className:\"w-full h-[320px] md:h-[400px] border-0\"}):/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-[320px] md:h-[400px] bg-[var(--slate-100)]\"}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3\",children:editingId===carte.id?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"Titre\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:editForm.titre,onChange:e=>setEditForm(f=>_objectSpread(_objectSpread({},f),{},{titre:e.target.value}))}),fieldErrors.titre&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-600 text-sm mt-1\",children:fieldErrors.titre})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"Iframe URL\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:editForm.iframeUrl,onChange:e=>setEditForm(f=>_objectSpread(_objectSpread({},f),{},{iframeUrl:e.target.value}))}),fieldErrors.iframeUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-600 text-sm mt-1\",children:fieldErrors.iframeUrl})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"L\\xE9gende\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:editForm.legende,onChange:e=>setEditForm(f=>_objectSpread(_objectSpread({},f),{},{legende:e.target.value}))}),fieldErrors.legende&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-600 text-sm mt-1\",children:fieldErrors.legende})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold mb-1\",children:\"Image (fichier) (optionnel, < 2Mo)\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",type:\"file\",accept:\"image/*\",onChange:e=>{var _e$target$files2;const f=((_e$target$files2=e.target.files)===null||_e$target$files2===void 0?void 0:_e$target$files2[0])||null;if(!f){setEditImageFile(null);return;}if(f.size>MAX_IMAGE_BYTES){e.target.value='';setEditImageFile(null);return;}setEditImageFile(f);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:saveEdit,type:\"button\",children:\"Enregistrer\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:cancelEdit,type:\"button\",children:\"Annuler\"})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold text-[var(--color-lavender)]\",children:carte.titre}),carte.legende&&/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:carte.legende}),isLoggedIn&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>startEdit(carte),type:\"button\",children:\"Modifier\"}),carte.imageStored&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:async()=>{if(!window.confirm('Retirer l’image stockée ?'))return;setError('');try{const updated=await deleteCarteImage(carte.id);setItems(prev=>prev.map(c=>c.id===carte.id?updated:c));setImgRevById(m=>_objectSpread(_objectSpread({},m),{},{[carte.id]:(m[carte.id]||0)+1}));}catch(err){logError(err);setError(\"Impossible de retirer l'image.\");}},type:\"button\",children:\"Retirer l\\u2019image\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger\",onClick:()=>remove(carte.id),type:\"button\",children:\"Supprimer\"})]})]})})]},carte.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>setPage(Math.max(1,page-1)),disabled:page===1,children:\"\\u2190 Pr\\xE9c\\xE9dent\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-4\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-muted\",children:[\"Page \",page]})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>hasNext&&setPage(page+1),disabled:!hasNext,children:\"Suivant \\u2192\"})]})]});}","map":{"version":3,"names":["useEffect","useMemo","useState","ApiAlert","Loader","useAuth","createCarte","deleteCarte","deleteCarteImage","getCarteImageUrl","getCartesPaged","updateCarte","uploadCarteImage","getApiErrorMessage","getApiErrorField","usePagination","logError","toastError","toastSuccess","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MAX_IMAGE_BYTES","GeographyPage","user","ready","loading","setLoading","error","setError","fieldErrors","setFieldErrors","items","setItems","page","setPage","hasNext","setHasNext","imgRevById","setImgRevById","createForm","setCreateForm","titre","iframeUrl","legende","createImageFile","setCreateImageFile","creating","setCreating","editingId","setEditingId","editForm","setEditForm","editImageFile","setEditImageFile","isLoggedIn","Boolean","fetchCartes","res","limit","Array","isArray","data","slice","length","err","msg","startEdit","carte","_carte$titre","_carte$iframeUrl","_carte$legende","id","cancelEdit","saveEdit","isAllowedIframe","raw","u","URL","includes","protocol","hostname","port","_unused","updated","m","_objectSpread","prev","map","c","field","remove","ok","window","confirm","filter","submitCreate","e","preventDefault","trim","_unused2","created","uploadErr","_unused3","className","children","message","kind","onClick","v","type","onSubmit","required","value","onChange","f","target","accept","_e$target$files","files","size","imageStored","src","alt","concat","title","referrerPolicy","_e$target$files2","Math","max","disabled"],"sources":["/mnt/c/code/leprovencal.ia/frontend/src/pages/GeographyPage.jsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\r\nimport ApiAlert from '../components/ApiAlert';\r\nimport Loader from '../components/Loader';\r\nimport { useAuth } from '../hooks/useAuth';\r\nimport { createCarte, deleteCarte, deleteCarteImage, getCarteImageUrl, getCartesPaged, updateCarte, uploadCarteImage, getApiErrorMessage, getApiErrorField } from '../services/api';\r\nimport usePagination from '../hooks/usePagination';\r\nimport { logError } from '../utils/logger';\r\nimport { toastError, toastSuccess } from '../utils/notify';\r\n\r\nconst MAX_IMAGE_BYTES = 2 * 1024 * 1024;\r\n\r\nexport default function GeographyPage() {\r\n  const { user, ready } = useAuth();\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [fieldErrors, setFieldErrors] = useState({});\r\n  const [items, setItems] = useState([]);\r\n  const { page, setPage } = usePagination(1, 1);\r\n  const [hasNext, setHasNext] = useState(false);\r\n\r\n  const [imgRevById, setImgRevById] = useState({});\r\n\r\n  const [createForm, setCreateForm] = useState({ titre: '', iframeUrl: '', legende: '' });\r\n  const [createImageFile, setCreateImageFile] = useState(null);\r\n  const [creating, setCreating] = useState(false);\r\n  const [editingId, setEditingId] = useState(null);\r\n  const [editForm, setEditForm] = useState({ titre: '', iframeUrl: '', legende: '' });\r\n  const [editImageFile, setEditImageFile] = useState(null);\r\n\r\n  const isLoggedIn = useMemo(() => Boolean(ready && user), [ready, user]);\r\n\r\n  const fetchCartes = async () => {\r\n    setLoading(true);\r\n    setError('');\r\n    try {\r\n      // request limit+1 to detect next page\r\n      const res = await getCartesPaged({ page, limit: 6 });\r\n      const items = Array.isArray(res.data) ? res.data : [];\r\n      // default: show first 5\r\n      setItems(items.slice(0, 5));\r\n      setHasNext(items.length > 5);\r\n    } catch (err) {\r\n      logError(err);\r\n      const msg = \"Impossible de charger les cartes.\";\r\n      setError(msg);\r\n      toastError(msg);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchCartes();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [page]);\r\n\r\n  const startEdit = (carte) => {\r\n    setEditingId(carte.id);\r\n    setEditForm({\r\n      titre: carte.titre ?? '',\r\n      iframeUrl: carte.iframeUrl ?? '',\r\n      legende: carte.legende ?? '',\r\n    });\r\n    setEditImageFile(null);\r\n    setFieldErrors({});\r\n  };\r\n\r\n  const cancelEdit = () => {\r\n    setEditingId(null);\r\n    setEditForm({ titre: '', iframeUrl: '', legende: '' });\r\n    setEditImageFile(null);\r\n    setFieldErrors({});\r\n  };\r\n\r\n  const saveEdit = async () => {\r\n    if (!editingId) return;\r\n    setError('');\r\n    setFieldErrors({});\r\n    // Validate iframe URL against whitelist\r\n    const isAllowedIframe = (raw) => {\r\n      if (!raw) return true;\r\n      try {\r\n        const u = new URL(raw);\r\n        if (!['http:', 'https:'].includes(u.protocol)) return false;\r\n        // allow only localhost with ports 3000 or 8000\r\n        if (u.hostname === 'localhost' && ['3000', '8000'].includes(u.port)) return true;\r\n        return false;\r\n      } catch {\r\n        return false;\r\n      }\r\n    };\r\n    if (editForm?.iframeUrl && !isAllowedIframe(editForm.iframeUrl)) return setError('Iframe URL non autorisée (localhost:3000 ou localhost:8000 uniquement).');\r\n    try {\r\n      let updated = await updateCarte(editingId, editForm);\r\n      if (editImageFile) {\r\n        updated = await uploadCarteImage(editingId, editImageFile);\r\n        setImgRevById((m) => ({ ...m, [editingId]: (m[editingId] || 0) + 1 }));\r\n        setEditImageFile(null);\r\n      }\r\n      setItems((prev) => prev.map((c) => (c.id === editingId ? updated : c)));\r\n      cancelEdit();\r\n    } catch (err) {\r\n      logError(err);\r\n      const msg = getApiErrorMessage(err);\r\n      setError(msg || \"Impossible de modifier la carte.\");\r\n      toastError(msg || \"Impossible de modifier la carte.\");\r\n      const field = getApiErrorField(err);\r\n      if (field) setFieldErrors({ [field]: msg });\r\n    }\r\n  };\r\n\r\n  const remove = async (id) => {\r\n    const ok = window.confirm('Supprimer cette carte ?');\r\n    if (!ok) return;\r\n    setError('');\r\n    setFieldErrors({});\r\n    try {\r\n      await deleteCarte(id);\r\n      setItems((prev) => prev.filter((c) => c.id !== id));\r\n      if (editingId === id) cancelEdit();\r\n      toastSuccess('Carte supprimée.');\r\n    } catch (err) {\r\n      logError(err);\r\n      const msg = getApiErrorMessage(err);\r\n      setError(msg || \"Impossible de supprimer la carte.\");\r\n      toastError(msg || \"Impossible de supprimer la carte.\");\r\n    }\r\n  };\r\n\r\n  const submitCreate = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setFieldErrors({});\r\n    const titre = (createForm.titre || '').trim();\r\n    const iframeUrl = (createForm.iframeUrl || '').trim();\r\n    if (!titre) return setError('Le titre est obligatoire.');\r\n    // Validate iframe url whitelist\r\n    const isAllowedIframe = (raw) => {\r\n      if (!raw) return true;\r\n      try {\r\n        const u = new URL(raw);\r\n        if (!['http:', 'https:'].includes(u.protocol)) return false;\r\n        if (u.hostname === 'localhost' && ['3000', '8000'].includes(u.port)) return true;\r\n        return false;\r\n      } catch {\r\n        return false;\r\n      }\r\n    };\r\n    if (!iframeUrl && !createImageFile) return setError('Il faut une iframe URL ou une image.');\r\n    if (iframeUrl && !isAllowedIframe(iframeUrl)) return setError('Iframe URL non autorisée (localhost:3000 ou localhost:8000 uniquement).');\r\n    try {\r\n      let created = await createCarte(createForm);\r\n      if (createImageFile) {\r\n        try {\r\n          created = await uploadCarteImage(created.id, createImageFile);\r\n          setImgRevById((m) => ({ ...m, [created.id]: (m[created.id] || 0) + 1 }));\r\n        } catch (uploadErr) {\r\n          // Avoid leaving a carte without iframe nor image\r\n          if (!iframeUrl) {\r\n            try {\r\n              await deleteCarte(created.id);\r\n            } catch {\r\n              // ignore\r\n            }\r\n          }\r\n          throw uploadErr;\r\n        }\r\n      }\r\n      setItems((prev) => [created, ...prev]);\r\n      setCreateForm({ titre: '', iframeUrl: '', legende: '' });\r\n      setCreateImageFile(null);\r\n      setCreating(false);\r\n      toastSuccess('Carte créée.');\r\n    } catch (err) {\r\n      logError(err);\r\n      const msg = getApiErrorMessage(err);\r\n      setError(msg || \"Impossible de créer la carte.\");\r\n      toastError(msg || \"Impossible de créer la carte.\");\r\n      const field = getApiErrorField(err);\r\n      if (field) setFieldErrors({ [field]: msg });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <main className=\"max-w-6xl mx-auto p-6\">\r\n      <h2 className=\"text-3xl font-bold text-[var(--color-lavender)] mb-4\">Cartes</h2>\r\n\r\n      {error && <ApiAlert message={error} kind=\"error\" className=\"mb-4\" />}\r\n\r\n      {isLoggedIn && (\r\n        <section className=\"mb-6 border rounded bg-white shadow-sm\">\r\n          <header className=\"px-4 py-3 border-b bg-[var(--bg)] flex items-center justify-between gap-2\">\r\n            <h3 className=\"font-bold text-xl text-[var(--color-lavender)]\">Gestion (loggué)</h3>\r\n            <button className=\"btn btn-primary\" onClick={() => setCreating((v) => !v)} type=\"button\">\r\n              {creating ? 'Fermer' : 'Ajouter une carte'}\r\n            </button>\r\n          </header>\r\n\r\n          {creating && (\r\n            <form onSubmit={submitCreate} className=\"p-4 grid md:grid-cols-3 gap-3\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Titre *</label>\r\n                <input\r\n                  className=\"input\"\r\n                  required\r\n                  value={createForm.titre}\r\n                  onChange={(e) => setCreateForm((f) => ({ ...f, titre: e.target.value }))}\r\n                />\r\n                {fieldErrors.titre && <div className=\"text-red-600 text-sm mt-1\">{fieldErrors.titre}</div>}\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Iframe URL (optionnel si image)</label>\r\n                <input\r\n                  className=\"input\"\r\n                  value={createForm.iframeUrl}\r\n                  onChange={(e) => setCreateForm((f) => ({ ...f, iframeUrl: e.target.value }))}\r\n                />\r\n                {fieldErrors.iframeUrl && <div className=\"text-red-600 text-sm mt-1\">{fieldErrors.iframeUrl}</div>}\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Légende</label>\r\n                <input\r\n                  className=\"input\"\r\n                  value={createForm.legende}\r\n                  onChange={(e) => setCreateForm((f) => ({ ...f, legende: e.target.value }))}\r\n                />\r\n                {fieldErrors.legende && <div className=\"text-red-600 text-sm mt-1\">{fieldErrors.legende}</div>}\r\n              </div>\r\n              <div className=\"md:col-span-3\">\r\n                <label className=\"block text-sm font-semibold mb-1\">Image (fichier) (optionnel, &lt; 2Mo)</label>\r\n                <input\r\n                  className=\"input\"\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => {\r\n                    const f = e.target.files?.[0] || null;\r\n                    if (!f) {\r\n                      setCreateImageFile(null);\r\n                      return;\r\n                    }\r\n                    if (f.size > MAX_IMAGE_BYTES) {\r\n                      e.target.value = '';\r\n                      setCreateImageFile(null);\r\n                      return;\r\n                    }\r\n                    setCreateImageFile(f);\r\n                  }}\r\n                />\r\n              </div>\r\n              <div className=\"md:col-span-3\">\r\n                <button type=\"submit\" className=\"btn btn-primary\">\r\n                  Créer\r\n                </button>\r\n              </div>\r\n            </form>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {loading ? (\r\n        <Loader message=\"Chargement des cartes...\" />\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          {items.map((carte) => (\r\n            <div key={carte.id} className=\"border rounded-lg overflow-hidden shadow-sm bg-white\">\r\n              {carte.imageStored ? (\r\n                <img\r\n                  src={getCarteImageUrl(carte.id, imgRevById[carte.id] || 0)}\r\n                  alt={`Illustration de ${carte.titre}`}\r\n                  loading=\"lazy\"\r\n                  className=\"w-full h-[320px] md:h-[400px] object-cover\"\r\n                />\r\n              ) : carte.iframeUrl ? (\r\n                <iframe\r\n                  src={carte.iframeUrl}\r\n                  title={carte.titre}\r\n                  loading=\"lazy\"\r\n                  referrerPolicy=\"no-referrer\"\r\n                  className=\"w-full h-[320px] md:h-[400px] border-0\"\r\n                />\r\n              ) : (\r\n                <div className=\"w-full h-[320px] md:h-[400px] bg-[var(--slate-100)]\" />\r\n              )}\r\n\r\n              <div className=\"p-3\">\r\n                {editingId === carte.id ? (\r\n                  <div className=\"space-y-2\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-semibold mb-1\">Titre</label>\r\n                      <input\r\n                        className=\"input\"\r\n                        value={editForm.titre}\r\n                        onChange={(e) => setEditForm((f) => ({ ...f, titre: e.target.value }))}\r\n                      />\r\n                      {fieldErrors.titre && <div className=\"text-red-600 text-sm mt-1\">{fieldErrors.titre}</div>}\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-semibold mb-1\">Iframe URL</label>\r\n                      <input\r\n                        className=\"input\"\r\n                        value={editForm.iframeUrl}\r\n                        onChange={(e) => setEditForm((f) => ({ ...f, iframeUrl: e.target.value }))}\r\n                      />\r\n                      {fieldErrors.iframeUrl && <div className=\"text-red-600 text-sm mt-1\">{fieldErrors.iframeUrl}</div>}\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-semibold mb-1\">Légende</label>\r\n                      <input\r\n                        className=\"input\"\r\n                        value={editForm.legende}\r\n                        onChange={(e) => setEditForm((f) => ({ ...f, legende: e.target.value }))}\r\n                      />\r\n                      {fieldErrors.legende && <div className=\"text-red-600 text-sm mt-1\">{fieldErrors.legende}</div>}\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-semibold mb-1\">Image (fichier) (optionnel, &lt; 2Mo)</label>\r\n                      <input\r\n                        className=\"input\"\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        onChange={(e) => {\r\n                          const f = e.target.files?.[0] || null;\r\n                          if (!f) {\r\n                            setEditImageFile(null);\r\n                            return;\r\n                          }\r\n                          if (f.size > MAX_IMAGE_BYTES) {\r\n                            e.target.value = '';\r\n                            setEditImageFile(null);\r\n                            return;\r\n                          }\r\n                          setEditImageFile(f);\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      <button className=\"btn btn-primary\" onClick={saveEdit} type=\"button\">\r\n                        Enregistrer\r\n                      </button>\r\n                      <button className=\"btn btn-secondary\" onClick={cancelEdit} type=\"button\">\r\n                        Annuler\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <>\r\n                    <div className=\"font-semibold text-[var(--color-lavender)]\">{carte.titre}</div>\r\n                    {carte.legende && <div className=\"text-sm text-gray-600\">{carte.legende}</div>}\r\n\r\n                    {isLoggedIn && (\r\n                      <div className=\"mt-3 flex flex-wrap gap-2\">\r\n                        <button className=\"btn btn-primary\" onClick={() => startEdit(carte)} type=\"button\">\r\n                          Modifier\r\n                        </button>\r\n                        {carte.imageStored && (\r\n                          <button\r\n                            className=\"btn btn-secondary\"\r\n                            onClick={async () => {\r\n                              if (!window.confirm('Retirer l’image stockée ?')) return;\r\n                              setError('');\r\n                              try {\r\n                                const updated = await deleteCarteImage(carte.id);\r\n                                setItems((prev) => prev.map((c) => (c.id === carte.id ? updated : c)));\r\n                                setImgRevById((m) => ({ ...m, [carte.id]: (m[carte.id] || 0) + 1 }));\r\n                              } catch (err) {\r\n                                logError(err);\r\n                                setError(\"Impossible de retirer l'image.\");\r\n                              }\r\n                            }}\r\n                            type=\"button\"\r\n                          >\r\n                            Retirer l’image\r\n                          </button>\r\n                        )}\r\n                        <button className=\"btn btn-danger\" onClick={() => remove(carte.id)} type=\"button\">\r\n                          Supprimer\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        )}\r\n        <div className=\"mt-6 flex justify-center gap-3\">\r\n          <button className=\"btn btn-secondary\" onClick={() => setPage(Math.max(1, page - 1))} disabled={page === 1}>\r\n            ← Précédent\r\n          </button>\r\n          <div className=\"flex items-center gap-4\">\r\n            <span className=\"text-sm text-muted\">Page {page}</span>\r\n          </div>\r\n          <button className=\"btn btn-primary\" onClick={() => hasNext && setPage(page + 1)} disabled={!hasNext}>\r\n            Suivant →\r\n          </button>\r\n        </div>\r\n    </main>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}