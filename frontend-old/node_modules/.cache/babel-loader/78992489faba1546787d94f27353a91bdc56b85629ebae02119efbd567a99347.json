{"ast":null,"code":"import _objectSpread from\"/mnt/c/code/leprovencal.ia/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// pages/Login.jsx\nimport{useEffect,useMemo,useState}from'react';import{useNavigate}from'react-router-dom';import ApiAlert from'../components/ApiAlert';import{getApiErrorMessage,login,getRetryAfterSeconds}from'../services/api';import{toastError}from'../utils/notify';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Login(){const[form,setForm]=useState({username:'',password:''});const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[lockUntilMs,setLockUntilMs]=useState(0);const[nowMs,setNowMs]=useState(Date.now());const navigate=useNavigate();const lockedSeconds=useMemo(()=>{const remaining=Math.ceil((lockUntilMs-nowMs)/1000);return remaining>0?remaining:0;},[lockUntilMs,nowMs]);const isLocked=lockedSeconds>0;useEffect(()=>{if(!isLocked)return;const t=setInterval(()=>setNowMs(Date.now()),250);return()=>clearInterval(t);},[isLocked]);const onChange=e=>{const{name,value}=e.target;setForm(f=>_objectSpread(_objectSpread({},f),{},{[name]:value}));};const onSubmit=async e=>{e.preventDefault();if(isLocked)return;setLoading(true);setError('');try{if(!form.username.trim()||!form.password){setError(\"Nom d’utilisateur et mot de passe requis.\");toastError(\"Nom d’utilisateur et mot de passe requis.\");return;}await login({username:form.username.trim(),password:form.password});navigate('/');}catch(err){var _err$response;const status=err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status;if(status===429){var _getRetryAfterSeconds;const retryAfter=(_getRetryAfterSeconds=getRetryAfterSeconds(err))!==null&&_getRetryAfterSeconds!==void 0?_getRetryAfterSeconds:10;setLockUntilMs(Date.now()+retryAfter*1000);}const msg=getApiErrorMessage(err);setError(msg||(status===429?'Trop de tentatives. Réessayez bientôt.':status===401?'Identifiants invalides.':'Erreur de connexion. Réessayez.'));toastError(msg||(status===429?'Trop de tentatives. Réessayez bientôt.':status===401?'Identifiants invalides.':'Erreur de connexion. Réessayez.'));}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md mx-auto mt-10 provence-card bg-white\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4 text-secondary\",children:\"Se connecter\"}),isLocked&&/*#__PURE__*/_jsx(ApiAlert,{message:\"Trop de tentatives. R\\xE9essayez dans \".concat(lockedSeconds,\"s.\"),kind:\"warning\",className:\"mb-3\"}),error&&/*#__PURE__*/_jsx(ApiAlert,{message:error,kind:\"error\",className:\"mb-3\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block mb-1 font-medium\",children:\"Nom d\\u2019utilisateur\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"username\",value:form.username,onChange:onChange,className:\"input\",placeholder:\"votre pseudo\",required:true,disabled:loading||isLocked})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block mb-1 font-medium\",children:\"Mot de passe\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",value:form.password,onChange:onChange,className:\"input\",placeholder:\"\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\",required:true,disabled:loading||isLocked})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||isLocked,className:\"btn btn-primary w-full disabled:opacity-50\",children:loading?'Connexion...':isLocked?\"Attendre (\".concat(lockedSeconds,\"s)\"):'Se connecter'})]})]});}","map":{"version":3,"names":["useEffect","useMemo","useState","useNavigate","ApiAlert","getApiErrorMessage","login","getRetryAfterSeconds","toastError","jsx","_jsx","jsxs","_jsxs","Login","form","setForm","username","password","loading","setLoading","error","setError","lockUntilMs","setLockUntilMs","nowMs","setNowMs","Date","now","navigate","lockedSeconds","remaining","Math","ceil","isLocked","t","setInterval","clearInterval","onChange","e","name","value","target","f","_objectSpread","onSubmit","preventDefault","trim","err","_err$response","status","response","_getRetryAfterSeconds","retryAfter","msg","className","children","message","concat","kind","type","placeholder","required","disabled"],"sources":["/mnt/c/code/leprovencal.ia/frontend/src/pages/LoginPage.jsx"],"sourcesContent":["// pages/Login.jsx\r\nimport { useEffect, useMemo, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ApiAlert from '../components/ApiAlert';\r\nimport { getApiErrorMessage, login, getRetryAfterSeconds } from '../services/api';\r\nimport { toastError } from '../utils/notify';\r\n\r\nexport default function Login() {\r\n  const [form, setForm] = useState({ username: '', password: '' });\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const [lockUntilMs, setLockUntilMs] = useState(0);\r\n  const [nowMs, setNowMs] = useState(Date.now());\r\n\r\n  const navigate = useNavigate();\r\n\r\n  const lockedSeconds = useMemo(() => {\r\n    const remaining = Math.ceil((lockUntilMs - nowMs) / 1000);\r\n    return remaining > 0 ? remaining : 0;\r\n  }, [lockUntilMs, nowMs]);\r\n\r\n  const isLocked = lockedSeconds > 0;\r\n\r\n  useEffect(() => {\r\n    if (!isLocked) return;\r\n    const t = setInterval(() => setNowMs(Date.now()), 250);\r\n    return () => clearInterval(t);\r\n  }, [isLocked]);\r\n\r\n  const onChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setForm((f) => ({ ...f, [name]: value }));\r\n  };\r\n\r\n  const onSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (isLocked) return;\r\n\r\n    setLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      if (!form.username.trim() || !form.password) {\r\n        setError(\"Nom d’utilisateur et mot de passe requis.\");\r\n        toastError(\"Nom d’utilisateur et mot de passe requis.\");\r\n        return;\r\n      }\r\n\r\n      await login({ username: form.username.trim(), password: form.password });\r\n      navigate('/');\r\n    } catch (err) {\r\n      const status = err?.response?.status;\r\n\r\n      if (status === 429) {\r\n        const retryAfter = getRetryAfterSeconds(err) ?? 10;\r\n        setLockUntilMs(Date.now() + retryAfter * 1000);\r\n      }\r\n\r\n      const msg = getApiErrorMessage(err);\r\n      setError(\r\n        msg ||\r\n          (status === 429\r\n            ? 'Trop de tentatives. Réessayez bientôt.'\r\n            : status === 401\r\n              ? 'Identifiants invalides.'\r\n              : 'Erreur de connexion. Réessayez.')\r\n      );\r\n      toastError(msg || (status === 429 ? 'Trop de tentatives. Réessayez bientôt.' : status === 401 ? 'Identifiants invalides.' : 'Erreur de connexion. Réessayez.'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-md mx-auto mt-10 provence-card bg-white\">\r\n      <h2 className=\"text-2xl font-bold mb-4 text-secondary\">Se connecter</h2>\r\n\r\n      {isLocked && (\r\n        <ApiAlert\r\n          message={`Trop de tentatives. Réessayez dans ${lockedSeconds}s.`}\r\n          kind=\"warning\"\r\n          className=\"mb-3\"\r\n        />\r\n      )}\r\n      {error && <ApiAlert message={error} kind=\"error\" className=\"mb-3\" />}\r\n\r\n      <form onSubmit={onSubmit} className=\"space-y-4\">\r\n        <div>\r\n          <label className=\"block mb-1 font-medium\">Nom d’utilisateur</label>\r\n          <input\r\n            type=\"text\"\r\n            name=\"username\"\r\n            value={form.username}\r\n            onChange={onChange}\r\n            className=\"input\"\r\n            placeholder=\"votre pseudo\"\r\n            required\r\n            disabled={loading || isLocked}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block mb-1 font-medium\">Mot de passe</label>\r\n          <input\r\n            type=\"password\"\r\n            name=\"password\"\r\n            value={form.password}\r\n            onChange={onChange}\r\n            className=\"input\"\r\n            placeholder=\"••••••••\"\r\n            required\r\n            disabled={loading || isLocked}\r\n          />\r\n        </div>\r\n\r\n        <button\r\n          type=\"submit\"\r\n          disabled={loading || isLocked}\r\n          className=\"btn btn-primary w-full disabled:opacity-50\"\r\n        >\r\n          {loading ? 'Connexion...' : isLocked ? `Attendre (${lockedSeconds}s)` : 'Se connecter'}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}