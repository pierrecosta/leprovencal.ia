{"ast":null,"code":"// services/api.js\nimport axios from 'axios';\nimport { logApiError } from '../utils/logger';\nimport { normalizeArticlePayload, normalizeDictionnairePayload, normalizeArticleOut, normalizeMotOut, normalizeHistoireOut, normalizeCarteOut, normalizeCartePayload, normalizeMenuHistoiresOut } from './normalizers';\n\n// ===== Base URL via .env (CRA) =====\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n\n// ===== Instance axios par défaut =====\n// On garde une instance \"publiques\" pour compat (GET publiques existantes)\nconst http = axios.create({\n  baseURL: API_BASE,\n  withCredentials: true // <-- enable cookies (SameSite handled by backend cookie)\n});\n\n// ===== Instance axios avec auth =====\n// Cette instance attache automatiquement le token s'il est présent\nconst authHttp = axios.create({\n  baseURL: API_BASE,\n  withCredentials: true // <-- send cookies automatically\n});\n\n// --- Token management (in-memory) ---\nlet _token = null;\nexport function setToken(token) {\n  _token = token;\n  if (token) {\n    // keep Authorization header for in-memory access-token usage (optional)\n    authHttp.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    try {\n      window.dispatchEvent(new Event('auth:login'));\n    } catch {}\n  } else {\n    delete authHttp.defaults.headers.common['Authorization'];\n    try {\n      window.dispatchEvent(new CustomEvent('auth:logout', {\n        detail: {\n          reason: 'manual'\n        }\n      }));\n    } catch {}\n  }\n}\nexport function getToken() {\n  return _token;\n}\nexport function clearToken() {\n  setToken(null);\n}\n\n// ==========================\n//   CROSS-CUTTING HELPERS\n// ==========================\nexport function getRetryAfterSeconds(err) {\n  var _err$response, _err$response$headers;\n  const raw = err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$headers = _err$response.headers) === null || _err$response$headers === void 0 ? void 0 : _err$response$headers['retry-after'];\n  if (!raw) return null;\n  const n = Number(raw);\n  return Number.isFinite(n) && n > 0 ? n : null;\n}\nfunction dispatchLogout(reason = 'unauthorized') {\n  clearToken();\n\n  // Let the app react if it wants (optional)\n  try {\n    window.dispatchEvent(new CustomEvent('auth:logout', {\n      detail: {\n        reason\n      }\n    }));\n  } catch {\n    // ignore\n  }\n\n  // Note: do NOT redirect to /login automatically. The app should remain browsable\n  // for anonymous users; authenticated-only actions will fail with 401 and the\n  // UI can decide whether to prompt for login or show an error. This keeps\n  // read-only browsing available by default.\n}\n\n// Normalizers moved to src/services/normalizers.js\n\n// ==========================\n//        AXIOS INSTANCES\n// ==========================\n\n// Interceptor pour l'instance auth\nauthHttp.interceptors.request.use(config => {\n  const token = getToken();\n  if (token) {\n    config.headers = {\n      ...config.headers,\n      Authorization: `Bearer ${token}`\n    };\n  }\n  return config;\n});\n\n// Global response handling (auth)\nauthHttp.interceptors.response.use(res => res, err => {\n  var _err$response2;\n  const status = err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status;\n  if (status === 401) dispatchLogout('token_invalid_or_expired');\n  logApiError(err);\n  return Promise.reject(err);\n});\n\n// Also log public API errors (no logout here)\nhttp.interceptors.response.use(res => res, err => {\n  logApiError(err);\n  return Promise.reject(err);\n});\n\n// ==========================\n//        ENDPOINTS\n// ==========================\n\n// --- Articles (publics) ---\nexport const getArticles = () => http.get(`/articles`).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeArticleOut) : res.data\n}));\n\n// Paged articles (skip/limit). page is 1-based.\nexport const getArticlesPaged = ({\n  page = 1,\n  limit = 10\n} = {}) => {\n  const skip = Math.max(0, (page - 1) * limit);\n  return http.get(`/articles`, {\n    params: {\n      skip,\n      limit\n    }\n  }).then(res => ({\n    ...res,\n    data: Array.isArray(res.data) ? res.data.map(normalizeArticleOut) : res.data\n  }));\n};\n\n// Create a new article (authenticated)\nexport async function createArticle(payload) {\n  const {\n    data\n  } = await authHttp.post(`/articles`, normalizeArticlePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeArticleOut(data);\n}\n\n// Delete an article (authenticated)\nexport async function deleteArticle(id) {\n  const res = await authHttp.delete(`/articles/${id}`);\n  return res;\n}\n\n// --- Dictionnaire (publics) ---\nexport const getDictionary = params => http.get(`/dictionnaire`, {\n  params\n}).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeMotOut) : res.data\n}));\nexport const getThemes = () => http.get(`/dictionnaire/themes`);\nexport const getCategories = theme => http.get(`/dictionnaire/categories`, {\n  params: {\n    theme\n  }\n});\n\n// --- Histoires & Légendes (publics) ---\nexport const getHistoires = params => http.get(`/histoires`, {\n  params\n});\n\n// Keep response shape, but normalize res.data for UI camelCase-only consumption\nexport const getMenuHistoires = () => http.get(`/histoires/menu`).then(res => ({\n  ...res,\n  data: normalizeMenuHistoiresOut(res.data)\n}));\nexport const getHistoireById = id => http.get(`/histoires/${id}`).then(res => ({\n  ...res,\n  data: normalizeHistoireOut(res.data)\n}));\nexport const findHistoire = titre => http.get(`/histoires/find`, {\n  params: {\n    titre\n  }\n}).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeHistoireOut) : res.data\n}));\nexport const getHistoiresPaged = ({\n  page,\n  limit\n}) => http.get(`/histoires/paged`, {\n  params: {\n    page,\n    limit\n  }\n});\n\n// --- Histoires (CRUD) (authenticated) ---\nexport async function createHistoire(payload) {\n  const {\n    data\n  } = await authHttp.post(`/histoires`, payload, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeHistoireOut(data);\n}\nexport async function updateHistoire(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/histoires/${id}`, payload, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeHistoireOut(data);\n}\nexport async function deleteHistoire(id) {\n  const res = await authHttp.delete(`/histoires/${id}`);\n  return res;\n}\n\n// --- Cartes (Géographie) (public + authenticated mutations) ---\nexport const getCartes = params => http.get(`/cartes`, {\n  params\n}).then(res => ({\n  ...res,\n  data: Array.isArray(res.data) ? res.data.map(normalizeCarteOut) : res.data\n}));\n\n// Paged cartes (convert page -> skip). page is 1-based.\nexport const getCartesPaged = ({\n  page = 1,\n  limit = 10\n} = {}) => {\n  const skip = Math.max(0, (page - 1) * limit);\n  return http.get(`/cartes`, {\n    params: {\n      skip,\n      limit\n    }\n  }).then(res => ({\n    ...res,\n    data: Array.isArray(res.data) ? res.data.map(normalizeCarteOut) : res.data\n  }));\n};\nexport async function createCarte(payload) {\n  const {\n    data\n  } = await authHttp.post(`/cartes`, normalizeCartePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeCarteOut(data);\n}\nexport async function updateCarte(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/cartes/${id}`, normalizeCartePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeCarteOut(data);\n}\nexport async function deleteCarte(id) {\n  const res = await authHttp.delete(`/cartes/${id}`);\n  return res;\n}\n\n// ==========================\n//   STORED IMAGES (BINARY)\n// ==========================\n\nexport function getArticleImageUrl(id, cacheBuster) {\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\n  return `${API_BASE}/articles/${id}/image${qs}`;\n}\nexport function getCarteImageUrl(id, cacheBuster) {\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\n  return `${API_BASE}/cartes/${id}/image${qs}`;\n}\nexport async function uploadArticleImage(id, file) {\n  const fd = new FormData();\n  fd.append('image', file);\n  const {\n    data\n  } = await authHttp.put(`/articles/${id}/image`, fd);\n  return normalizeArticleOut(data);\n}\nexport async function deleteArticleImage(id) {\n  const {\n    data\n  } = await authHttp.delete(`/articles/${id}/image`);\n  return normalizeArticleOut(data);\n}\nexport async function uploadCarteImage(id, file) {\n  const fd = new FormData();\n  fd.append('image', file);\n  const {\n    data\n  } = await authHttp.put(`/cartes/${id}/image`, fd);\n  return normalizeCarteOut(data);\n}\nexport async function deleteCarteImage(id) {\n  const {\n    data\n  } = await authHttp.delete(`/cartes/${id}/image`);\n  return normalizeCarteOut(data);\n}\n\n// --- Dictionnaire: update d'un mot (ligne du tableau)\nexport async function updateMot(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/dictionnaire/${id}`, normalizeDictionnairePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeMotOut(data);\n}\n\n// --- Articles: update d'une carte/article\nexport async function updateArticle(id, payload) {\n  const {\n    data\n  } = await authHttp.put(`/articles/${id}`, normalizeArticlePayload(payload), {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return normalizeArticleOut(data);\n}\n\n// ==========================\n//       AUTH SERVICES\n// ==========================\n\nexport async function login({\n  username,\n  password\n}) {\n  const params = new URLSearchParams();\n  params.append('username', username);\n  params.append('password', password);\n  const {\n    data\n  } = await http.post(`/auth/login`, params, {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    }\n  });\n\n  // Two possible server behaviors:\n  // - Return { access_token } (Bearer token) -> frontend stores it via setToken\n  // - Or set a HttpOnly cookie and return a simple success payload -> emit login event\n  if (data !== null && data !== void 0 && data.access_token) {\n    setToken(data.access_token);\n  } else {\n    try {\n      window.dispatchEvent(new Event('auth:login'));\n    } catch {\n      // ignore\n    }\n  }\n  return data;\n}\nexport async function register({\n  username,\n  password\n}) {\n  const {\n    data\n  } = await http.post(`/auth/register`, {\n    username,\n    password\n  }, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  return data;\n}\n\n/**\r\n * Récupère l'utilisateur courant (protégé)\r\n * - Nécessite Authorization: Bearer <token>\r\n * - Retour: { username }\r\n */\nexport async function getMe() {\n  const {\n    data\n  } = await authHttp.get(`/auth/me`);\n  return data;\n}\n\n// (Optionnel) helper logout\nexport function logout() {\n  // Try to notify server (if an endpoint exists) to clear HttpOnly cookie, then dispatch logout locally.\n  (async () => {\n    try {\n      await http.post('/auth/logout');\n    } catch {\n      // ignore errors (endpoint may not exist)\n    } finally {\n      dispatchLogout('manual');\n    }\n  })();\n}\n\n// ==========================\n//    EXPORTS UTILES PAR DÉFAUT\n// ==========================\nexport const api = http;\nexport const apiAuth = authHttp;\n\n// --- Error handling ---\nexport function getApiErrorMessage(err) {\n  var _err$response3, _err$response4, _err$response4$header, _err$response5, _err$response5$data, _err$response6, _err$response6$data;\n  const status = err === null || err === void 0 ? void 0 : (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : _err$response3.status;\n  const retryAfter = err === null || err === void 0 ? void 0 : (_err$response4 = err.response) === null || _err$response4 === void 0 ? void 0 : (_err$response4$header = _err$response4.headers) === null || _err$response4$header === void 0 ? void 0 : _err$response4$header['retry-after'];\n  const detail = err === null || err === void 0 ? void 0 : (_err$response5 = err.response) === null || _err$response5 === void 0 ? void 0 : (_err$response5$data = _err$response5.data) === null || _err$response5$data === void 0 ? void 0 : _err$response5$data.detail;\n  if (detail && typeof detail === 'object') {\n    if (typeof detail.message === 'string' && detail.message.trim() !== '') return detail.message;\n    if (typeof detail.code === 'string' && detail.code.trim() !== '') return detail.code;\n    try {\n      return JSON.stringify(detail);\n    } catch {\n      return 'Erreur API';\n    }\n  }\n  if (typeof detail === 'string') return detail;\n  const msg = (err === null || err === void 0 ? void 0 : (_err$response6 = err.response) === null || _err$response6 === void 0 ? void 0 : (_err$response6$data = _err$response6.data) === null || _err$response6$data === void 0 ? void 0 : _err$response6$data.message) || (err === null || err === void 0 ? void 0 : err.message);\n  const base = typeof msg === 'string' ? msg : 'Erreur API';\n  if (status === 429 && retryAfter) return `${base} (Retry-After: ${retryAfter}s)`;\n  return base;\n}\n\n// Retourne le champ ciblé par l'erreur si fourni par l'API (ex: { detail: { field: 'titre' } })\nexport function getApiErrorField(err) {\n  var _err$response$data$de, _err$response7, _err$response7$data, _err$response7$data$d;\n  return (_err$response$data$de = err === null || err === void 0 ? void 0 : (_err$response7 = err.response) === null || _err$response7 === void 0 ? void 0 : (_err$response7$data = _err$response7.data) === null || _err$response7$data === void 0 ? void 0 : (_err$response7$data$d = _err$response7$data.detail) === null || _err$response7$data$d === void 0 ? void 0 : _err$response7$data$d.field) !== null && _err$response$data$de !== void 0 ? _err$response$data$de : null;\n}","map":{"version":3,"names":["axios","logApiError","normalizeArticlePayload","normalizeDictionnairePayload","normalizeArticleOut","normalizeMotOut","normalizeHistoireOut","normalizeCarteOut","normalizeCartePayload","normalizeMenuHistoiresOut","API_BASE","process","env","REACT_APP_API_URL","http","create","baseURL","withCredentials","authHttp","_token","setToken","token","defaults","headers","common","window","dispatchEvent","Event","CustomEvent","detail","reason","getToken","clearToken","getRetryAfterSeconds","err","_err$response","_err$response$headers","raw","response","n","Number","isFinite","dispatchLogout","interceptors","request","use","config","Authorization","res","_err$response2","status","Promise","reject","getArticles","get","then","data","Array","isArray","map","getArticlesPaged","page","limit","skip","Math","max","params","createArticle","payload","post","deleteArticle","id","delete","getDictionary","getThemes","getCategories","theme","getHistoires","getMenuHistoires","getHistoireById","findHistoire","titre","getHistoiresPaged","createHistoire","updateHistoire","put","deleteHistoire","getCartes","getCartesPaged","createCarte","updateCarte","deleteCarte","getArticleImageUrl","cacheBuster","qs","encodeURIComponent","String","getCarteImageUrl","uploadArticleImage","file","fd","FormData","append","deleteArticleImage","uploadCarteImage","deleteCarteImage","updateMot","updateArticle","login","username","password","URLSearchParams","access_token","register","getMe","logout","api","apiAuth","getApiErrorMessage","_err$response3","_err$response4","_err$response4$header","_err$response5","_err$response5$data","_err$response6","_err$response6$data","retryAfter","message","trim","code","JSON","stringify","msg","base","getApiErrorField","_err$response$data$de","_err$response7","_err$response7$data","_err$response7$data$d","field"],"sources":["/mnt/c/code/leprovencal.ia/frontend/src/services/api.js"],"sourcesContent":["// services/api.js\r\nimport axios from 'axios';\r\nimport { logApiError } from '../utils/logger';\r\nimport {\r\n  normalizeArticlePayload,\r\n  normalizeDictionnairePayload,\r\n  normalizeArticleOut,\r\n  normalizeMotOut,\r\n  normalizeHistoireOut,\r\n  normalizeCarteOut,\r\n  normalizeCartePayload,\r\n  normalizeMenuHistoiresOut,\r\n} from './normalizers';\r\n\r\n// ===== Base URL via .env (CRA) =====\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:8000';\r\n\r\n// ===== Instance axios par défaut =====\r\n// On garde une instance \"publiques\" pour compat (GET publiques existantes)\r\nconst http = axios.create({\r\n  baseURL: API_BASE,\r\n  withCredentials: true, // <-- enable cookies (SameSite handled by backend cookie)\r\n});\r\n\r\n// ===== Instance axios avec auth =====\r\n// Cette instance attache automatiquement le token s'il est présent\r\nconst authHttp = axios.create({\r\n  baseURL: API_BASE,\r\n  withCredentials: true, // <-- send cookies automatically\r\n});\r\n\r\n// --- Token management (in-memory) ---\r\nlet _token = null;\r\n\r\nexport function setToken(token) {\r\n  _token = token;\r\n  if (token) {\r\n    // keep Authorization header for in-memory access-token usage (optional)\r\n    authHttp.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n    try { window.dispatchEvent(new Event('auth:login')); } catch {}\r\n  } else {\r\n    delete authHttp.defaults.headers.common['Authorization'];\r\n    try { window.dispatchEvent(new CustomEvent('auth:logout', { detail: { reason: 'manual' } })); } catch {}\r\n  }\r\n}\r\n\r\nexport function getToken() {\r\n  return _token;\r\n}\r\n\r\nexport function clearToken() {\r\n  setToken(null);\r\n}\r\n\r\n// ==========================\r\n//   CROSS-CUTTING HELPERS\r\n// ==========================\r\nexport function getRetryAfterSeconds(err) {\r\n  const raw = err?.response?.headers?.['retry-after'];\r\n  if (!raw) return null;\r\n  const n = Number(raw);\r\n  return Number.isFinite(n) && n > 0 ? n : null;\r\n}\r\n\r\nfunction dispatchLogout(reason = 'unauthorized') {\r\n  clearToken();\r\n\r\n  // Let the app react if it wants (optional)\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('auth:logout', { detail: { reason } }));\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  // Note: do NOT redirect to /login automatically. The app should remain browsable\r\n  // for anonymous users; authenticated-only actions will fail with 401 and the\r\n  // UI can decide whether to prompt for login or show an error. This keeps\r\n  // read-only browsing available by default.\r\n}\r\n\r\n// Normalizers moved to src/services/normalizers.js\r\n\r\n// ==========================\r\n//        AXIOS INSTANCES\r\n// ==========================\r\n\r\n// Interceptor pour l'instance auth\r\nauthHttp.interceptors.request.use((config) => {\r\n  const token = getToken();\r\n  if (token) {\r\n    config.headers = {\r\n      ...config.headers,\r\n      Authorization: `Bearer ${token}`,\r\n    };\r\n  }\r\n  return config;\r\n});\r\n\r\n// Global response handling (auth)\r\nauthHttp.interceptors.response.use(\r\n  (res) => res,\r\n  (err) => {\r\n    const status = err?.response?.status;\r\n    if (status === 401) dispatchLogout('token_invalid_or_expired');\r\n    logApiError(err);\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\n// Also log public API errors (no logout here)\r\nhttp.interceptors.response.use(\r\n  (res) => res,\r\n  (err) => {\r\n    logApiError(err);\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\n// ==========================\r\n//        ENDPOINTS\r\n// ==========================\r\n\r\n// --- Articles (publics) ---\r\nexport const getArticles = () =>\r\n  http.get(`/articles`).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeArticleOut) : res.data,\r\n  }));\r\n\r\n// Paged articles (skip/limit). page is 1-based.\r\nexport const getArticlesPaged = ({ page = 1, limit = 10 } = {}) => {\r\n  const skip = Math.max(0, (page - 1) * limit);\r\n  return http.get(`/articles`, { params: { skip, limit } }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeArticleOut) : res.data,\r\n  }));\r\n};\r\n\r\n// Create a new article (authenticated)\r\nexport async function createArticle(payload) {\r\n  const { data } = await authHttp.post(`/articles`, normalizeArticlePayload(payload), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\n// Delete an article (authenticated)\r\nexport async function deleteArticle(id) {\r\n  const res = await authHttp.delete(`/articles/${id}`);\r\n  return res;\r\n}\r\n\r\n// --- Dictionnaire (publics) ---\r\nexport const getDictionary = (params) =>\r\n  http.get(`/dictionnaire`, { params }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeMotOut) : res.data,\r\n  }));\r\n\r\nexport const getThemes = () => http.get(`/dictionnaire/themes`);\r\nexport const getCategories = (theme) => http.get(`/dictionnaire/categories`, { params: { theme } });\r\n\r\n// --- Histoires & Légendes (publics) ---\r\nexport const getHistoires = (params) => http.get(`/histoires`, { params });\r\n\r\n// Keep response shape, but normalize res.data for UI camelCase-only consumption\r\nexport const getMenuHistoires = () =>\r\n  http.get(`/histoires/menu`).then((res) => ({ ...res, data: normalizeMenuHistoiresOut(res.data) }));\r\n\r\nexport const getHistoireById = (id) =>\r\n  http.get(`/histoires/${id}`).then((res) => ({ ...res, data: normalizeHistoireOut(res.data) }));\r\n\r\nexport const findHistoire = (titre) =>\r\n  http.get(`/histoires/find`, { params: { titre } }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeHistoireOut) : res.data,\r\n  }));\r\n\r\nexport const getHistoiresPaged = ({ page, limit }) => http.get(`/histoires/paged`, { params: { page, limit } });\r\n\r\n// --- Histoires (CRUD) (authenticated) ---\r\nexport async function createHistoire(payload) {\r\n  const { data } = await authHttp.post(`/histoires`, payload, {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeHistoireOut(data);\r\n}\r\n\r\nexport async function updateHistoire(id, payload) {\r\n  const { data } = await authHttp.put(`/histoires/${id}`, payload, {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeHistoireOut(data);\r\n}\r\n\r\nexport async function deleteHistoire(id) {\r\n  const res = await authHttp.delete(`/histoires/${id}`);\r\n  return res;\r\n}\r\n\r\n// --- Cartes (Géographie) (public + authenticated mutations) ---\r\nexport const getCartes = (params) =>\r\n  http.get(`/cartes`, { params }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeCarteOut) : res.data,\r\n  }));\r\n\r\n// Paged cartes (convert page -> skip). page is 1-based.\r\nexport const getCartesPaged = ({ page = 1, limit = 10 } = {}) => {\r\n  const skip = Math.max(0, (page - 1) * limit);\r\n  return http.get(`/cartes`, { params: { skip, limit } }).then((res) => ({\r\n    ...res,\r\n    data: Array.isArray(res.data) ? res.data.map(normalizeCarteOut) : res.data,\r\n  }));\r\n};\r\n\r\nexport async function createCarte(payload) {\r\n  const { data } = await authHttp.post(`/cartes`, normalizeCartePayload(payload), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\nexport async function updateCarte(id, payload) {\r\n  const { data } = await authHttp.put(`/cartes/${id}`, normalizeCartePayload(payload), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\nexport async function deleteCarte(id) {\r\n  const res = await authHttp.delete(`/cartes/${id}`);\r\n  return res;\r\n}\r\n\r\n// ==========================\r\n//   STORED IMAGES (BINARY)\r\n// ==========================\r\n\r\nexport function getArticleImageUrl(id, cacheBuster) {\r\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\r\n  return `${API_BASE}/articles/${id}/image${qs}`;\r\n}\r\n\r\nexport function getCarteImageUrl(id, cacheBuster) {\r\n  const qs = cacheBuster ? `?v=${encodeURIComponent(String(cacheBuster))}` : '';\r\n  return `${API_BASE}/cartes/${id}/image${qs}`;\r\n}\r\n\r\nexport async function uploadArticleImage(id, file) {\r\n  const fd = new FormData();\r\n  fd.append('image', file);\r\n  const { data } = await authHttp.put(`/articles/${id}/image`, fd);\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\nexport async function deleteArticleImage(id) {\r\n  const { data } = await authHttp.delete(`/articles/${id}/image`);\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\nexport async function uploadCarteImage(id, file) {\r\n  const fd = new FormData();\r\n  fd.append('image', file);\r\n  const { data } = await authHttp.put(`/cartes/${id}/image`, fd);\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\nexport async function deleteCarteImage(id) {\r\n  const { data } = await authHttp.delete(`/cartes/${id}/image`);\r\n  return normalizeCarteOut(data);\r\n}\r\n\r\n// --- Dictionnaire: update d'un mot (ligne du tableau)\r\nexport async function updateMot(id, payload) {\r\n  const { data } = await authHttp.put(\r\n    `/dictionnaire/${id}`,\r\n    normalizeDictionnairePayload(payload),\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  );\r\n  return normalizeMotOut(data);\r\n}\r\n\r\n// --- Articles: update d'une carte/article\r\nexport async function updateArticle(id, payload) {\r\n  const { data } = await authHttp.put(\r\n    `/articles/${id}`,\r\n    normalizeArticlePayload(payload),\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  );\r\n  return normalizeArticleOut(data);\r\n}\r\n\r\n// ==========================\r\n//       AUTH SERVICES\r\n// ==========================\r\n\r\nexport async function login({ username, password }) {\r\n  const params = new URLSearchParams();\r\n  params.append('username', username);\r\n  params.append('password', password);\r\n\r\n  const { data } = await http.post(`/auth/login`, params, {\r\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n  });\r\n\r\n  // Two possible server behaviors:\r\n  // - Return { access_token } (Bearer token) -> frontend stores it via setToken\r\n  // - Or set a HttpOnly cookie and return a simple success payload -> emit login event\r\n  if (data?.access_token) {\r\n    setToken(data.access_token);\r\n  } else {\r\n    try {\r\n      window.dispatchEvent(new Event('auth:login'));\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }\r\n  return data;\r\n}\r\n\r\nexport async function register({ username, password }) {\r\n  const { data } = await http.post(\r\n    `/auth/register`,\r\n    { username, password },\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  );\r\n  return data;\r\n}\r\n\r\n/**\r\n * Récupère l'utilisateur courant (protégé)\r\n * - Nécessite Authorization: Bearer <token>\r\n * - Retour: { username }\r\n */\r\nexport async function getMe() {\r\n  const { data } = await authHttp.get(`/auth/me`);\r\n  return data;\r\n}\r\n\r\n// (Optionnel) helper logout\r\nexport function logout() {\r\n  // Try to notify server (if an endpoint exists) to clear HttpOnly cookie, then dispatch logout locally.\r\n  (async () => {\r\n    try {\r\n      await http.post('/auth/logout');\r\n    } catch {\r\n      // ignore errors (endpoint may not exist)\r\n    } finally {\r\n      dispatchLogout('manual');\r\n    }\r\n  })();\r\n}\r\n\r\n// ==========================\r\n//    EXPORTS UTILES PAR DÉFAUT\r\n// ==========================\r\nexport const api = http;\r\nexport const apiAuth = authHttp;\r\n\r\n// --- Error handling ---\r\nexport function getApiErrorMessage(err) {\r\n  const status = err?.response?.status;\r\n  const retryAfter = err?.response?.headers?.['retry-after'];\r\n\r\n  const detail = err?.response?.data?.detail;\r\n\r\n  if (detail && typeof detail === 'object') {\r\n    if (typeof detail.message === 'string' && detail.message.trim() !== '') return detail.message;\r\n    if (typeof detail.code === 'string' && detail.code.trim() !== '') return detail.code;\r\n    try {\r\n      return JSON.stringify(detail);\r\n    } catch {\r\n      return 'Erreur API';\r\n    }\r\n  }\r\n\r\n  if (typeof detail === 'string') return detail;\r\n\r\n  const msg = err?.response?.data?.message || err?.message;\r\n  const base = typeof msg === 'string' ? msg : 'Erreur API';\r\n\r\n  if (status === 429 && retryAfter) return `${base} (Retry-After: ${retryAfter}s)`;\r\n  return base;\r\n}\r\n\r\n// Retourne le champ ciblé par l'erreur si fourni par l'API (ex: { detail: { field: 'titre' } })\r\nexport function getApiErrorField(err) {\r\n  return err?.response?.data?.detail?.field ?? null;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}